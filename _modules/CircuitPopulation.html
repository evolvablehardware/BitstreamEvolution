

<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="Testing Github" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="0.1.0" />
    <meta name="docsearch:version" content="" />
    
      <title>CircuitPopulation &mdash; Testing Github 0.1.0 documentation</title>
    
      <link rel="icon" href="https://evolvablehardware.org/images/EHWsetup.jpg" />
    <link rel="stylesheet" href="../_static/bootstrap-icons.css" type="text/css" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/pygments.css', priority=200, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=75810a84" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/graphviz.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/pygments_dark.css', priority=500, rel='stylesheet', type='text/css', media='(prefers-color-scheme: dark)', id='pygments_dark_css')" -->
          <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=5349f25f" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/sphinx-design.min.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/colorsets/sphinx-nefertiti-default-0.3.7.min.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="../_static/colorsets/sphinx-nefertiti-default-0.3.7.min.css" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/fonts/nunito/stylesheet.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="../_static/fonts/nunito/stylesheet.css" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/fonts/red-hat-mono/stylesheet.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="../_static/fonts/red-hat-mono/stylesheet.css" />
        <link rel="index" title="Index" href="../genindex.html" />
        <link rel="search" title="Search" href="../search.html" />
        <link rel="top" title="Testing Github 0.1.0 documentation" href="#" />
        <link rel="up" title="Module code" href="index.html" />
    <style>
      :root {
        --nftt-body-font-family: "Nunito", var(--nftt-font-sans-serif) !important;
        --nftt-font-monospace: "Red Hat Mono", var(--nftt-font-family-monospace) !important;
        --nftt-project-name-font: var(--nftt-body-font-family);
        --nftt-documentation-font: var(--nftt-body-font-family);
        --nftt-doc-headers-font: "Georgia", var(--nftt-documentation-font);}
      h1 *, h2 *, h3 *, h4 *, h5 *, h6 * { font-size: inherit; }
    </style>
  </head>
  <body>
    <header class="navbar navbar-expand-xl navbar-dark nftt-navbar flex-column fixed-top">
      <div class="skip-links container-fluid visually-hidden-focusable overflow-hidden justify-content-start flex-grow-1">
        <div class="border-bottom mb-2 pb-2 w-100">
          <a class="d-none d-md-inline-flex p-2 m-1" href="#sidebar-filter">Skip to docs navigation</a>
          <a class="d-inline-flex p-2 m-1" href="#content">Skip to main content</a>
        </div>
      </div>
      <nav class="container-xxl nftt-gutter flex-wrap flex-xl-nowrap" aria-label="Main navigation">
        <div class="nftt-navbar-toggler">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Toggle documentation navigation">
            <i class="bi bi-list"></i>
          </button>
        </div>
          <a href="../index.html"
              
              class="navbar-brand p-0 me-0 md-lg-2"
          ><span class="brand-text">Testing Github</span></a>
        
        <div class="d-flex d-xl-none">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttSearch" aria-controls="nfttSearch" aria-label="Search">
            <i class="bi bi-search"></i>
          </button>
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttNavbar" aria-controls="nfttNavbar" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
        
<div class="offcanvas-xl offcanvas-end flex-grow-1" tabindex="-1" id="nfttSearch" aria-labelledby="nfttSearchOffcanvasLabel" data-bs-scroll="true">
  <div class="offcanvas-header px-4 pb-0">
    <h5 class="offcanvas-title fw-bold" id="nfttSearchOffcanvasLabel">Search the documentation</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttSearch"></button>
  </div>
  <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
    <hr class="d-xl-none text-white-50">
    <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
      <li class="nav-item col-12 col-xl-auto">
        <form id="nftt-search-form" action="../search.html" method="get">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search docs" aria-label="Search" aria-describedby="button-search">
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <button class="btn btn-primary" type="submit" id="button-search" aria-label="Search"><i class="bi bi-search"></i></button>
          </div>
        </form>
      </li>
    </ul>
  </div>
</div>

        <div class="offcanvas-xl offcanvas-end" tabindex="-1" id="nfttNavbar" aria-labelledby="nfttNavbarOffcanvasLabel" data-bs-scroll="true">
          <div class="offcanvas-header px-4 pb-0">
            <div class="offcanvas-title navbar-brand" id="nfttNavbarOffcanvasLabel"><span class="brand-text">Nefertiti for Sphinx</span></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttNavbar"></button>
          </div>
          <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
            <hr class="d-xl-none text-white-50">
            <ul class="navbar-nav flex-row align-items-center flex-wrap ms-lg-auto">
              
              <!-- version_dropdown.html -->

              
              <!-- colorscheme_dropdown.html -->
<li class="nav-item dropdown">
  <a class="nav-link d-flex py-2 px-0 px-xl-2 dropdown-toggle align-items-center" id="snftt-luz" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false" aria-label="Toggle light/dark">
    <i class="bi bi-circle-half" data-snftt-luz-icon-active></i>
    <span id="snftt-luz-text" class="d-xl-none small ms-2">Toggle light/dark</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="snftt-luz-text">
    <li>
      <h6 class="dropdown-header">Light/dark</h6>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="light" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-sun" data-snftt-luz-icon="light"></i>
        </span>
        <span class="small ms-3">Light</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="dark" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-moon-stars" data-snftt-luz-icon="dark"></i>
        </span>
        <span class="small ms-3">Dark</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item current d-flex align-items-center" data-snftt-luz="default" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-circle-half" data-snftt-luz-icon="default"></i>
        </span>
        <span class="small ms-3">Default</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
  </ul>
</li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div class="container-fluid flex-grow-1">
      <div class="nftt-gutter nftt-page">
        <aside class="nftt-sidebar ">
          <div class="nftt-sidebar-content">
            
            <div class="title d-none d-xl-block">
              <i class="bi bi-book"></i>&nbsp;&nbsp;<span>Index</span>
            </div>
            <div id="sidebar" tabindex="-1" class="offcanvas-xl offcanvas-start" aria-labelledby="nfttSidebarOffcanvasLabel">
                <!-- danirus sidebartemplate: "globaltoc.html" --><div class="offcanvas-header border-bottom">
  <h5 class="offcanvas-title fw-bold" id="nfttSidebarOffcanvasLabel">
    Table of contents
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#sidebar"></button>
</div>

<div class="offcanvas-body">
  <nav class="toc" aria-label="Main menu">
    <div class="mb-3 p-1 pt-3 pb-4 border-bottom">
      <input id="sidebar-filter" type="text" name="filter" class="form-control form-control-sm" placeholder="filter" aria-label="filter">
    </div>
    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code/index.html">Code Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../code/arg_parse_utils.html">arg_parse_utils.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/ascTemplateBuilder.html">ascTemplateBuilder.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/Circuit.html">Circuit.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/CircuitPopulation.html">CircuitPopulation.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/config_builder.html">config_builder.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/Config.html">Config.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/ConfigBuilder.html">ConfigBuilder.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/ConfigValue.html">ConfigValue.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/Evolution.html">Evolution.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/evolve.html">evolve.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/init.html">init.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/Logger.html">Logger.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/Microcontroller.html">Microcontroller.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/Monitor.html">Monitor.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/multi_evolve.html">multi_evolve.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/PlotEvolutionLive.html">PlotEvolutionLive.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/utilities.html">utilities.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../code/index.html#documentation-of-tools">Documentation of Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../code/tools/pulse_histogram.html">pulse_histogram.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/tools/reconstruct.html">reconstruct.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../code/index.html#things-to-do">Things To Do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">dev index</a></li>
</ul>

  </nav>
  <template data-toggle-item-template>
    <button class="btn btn-sm btn-link toctree-expand" type="button">
      <i class="bi bi-caret-right"></i>
      <span class="visually-hidden">Toggle menu contents</span>
    </button>
  </template>
</div>
            </div>
            
          </div>
        </aside>
        <article id="content" class="nftt-content" role="main">
    <h1>Source code for CircuitPopulation</h1><div class="highlight"><pre>
<span></span><span class="linenos">   1</span><span class="sd">&quot;&quot;&quot; </span>
<span class="linenos">   2</span><span class="sd">Circuit Population</span>
<span class="linenos">   3</span><span class="sd">------------------</span>
<span class="linenos">   4</span>
<span class="linenos">   5</span><span class="sd">This class was reviewed, and should be fully documented at a basic level.</span>
<span class="linenos">   6</span>
<span class="linenos">   7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">   8</span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="linenos">   9</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos">  10</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedTuple</span>
<span class="linenos">  11</span><span class="kn">from</span><span class="w"> </span><span class="nn">shutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">copyfile</span>
<span class="linenos">  12</span><span class="kn">from</span><span class="w"> </span><span class="nn">sortedcontainers</span><span class="w"> </span><span class="kn">import</span> <span class="n">SortedKeyList</span>
<span class="linenos">  13</span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">ceil</span>
<span class="linenos">  14</span><span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_rng</span>
<span class="linenos">  15</span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="linenos">  16</span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">zip_longest</span>
<span class="linenos">  17</span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
<span class="linenos">  18</span><span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">time</span>
<span class="linenos">  19</span><span class="kn">from</span><span class="w"> </span><span class="nn">subprocess</span><span class="w"> </span><span class="kn">import</span> <span class="n">run</span>
<span class="linenos">  20</span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="linenos">  21</span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="linenos">  22</span><span class="kn">from</span><span class="w"> </span><span class="nn">mmap</span><span class="w"> </span><span class="kn">import</span> <span class="n">mmap</span>
<span class="linenos">  23</span><span class="kn">from</span><span class="w"> </span><span class="nn">Circuit.FileBasedCircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileBasedCircuit</span>
<span class="linenos">  24</span><span class="kn">from</span><span class="w"> </span><span class="nn">Circuit.FullySimCircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">FullySimCircuit</span>
<span class="linenos">  25</span><span class="kn">from</span><span class="w"> </span><span class="nn">Circuit.IntrinsicCircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">IntrinsicCircuit</span>
<span class="linenos">  26</span><span class="kn">from</span><span class="w"> </span><span class="nn">Circuit.PulseCountFitnessFunction</span><span class="w"> </span><span class="kn">import</span> <span class="n">PulseCountFitnessFunction</span>
<span class="linenos">  27</span><span class="kn">from</span><span class="w"> </span><span class="nn">Circuit.SimHardwareCircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimHardwareCircuit</span>
<span class="linenos">  28</span><span class="kn">from</span><span class="w"> </span><span class="nn">Circuit.ToneDiscriminatorFitnessFunction</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToneDiscriminatorFitnessFunction</span>
<span class="linenos">  29</span><span class="kn">from</span><span class="w"> </span><span class="nn">Circuit.VarMaxFitnessFunction</span><span class="w"> </span><span class="kn">import</span> <span class="n">VarMaxFitnessFunction</span>
<span class="linenos">  30</span><span class="kn">from</span><span class="w"> </span><span class="nn">Config</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
<span class="linenos">  31</span><span class="kn">from</span><span class="w"> </span><span class="nn">ascTemplateBuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">ascTemplateBuilder</span>
<span class="linenos">  32</span><span class="kn">from</span><span class="w"> </span><span class="nn">utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">wipe_folder</span>
<span class="linenos">  33</span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="linenos">  34</span>
<span class="linenos">  35</span><span class="n">RANDOMIZE_UNTIL_NOT_SET_ERR_MSG</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="linenos">  36</span><span class="s1">RANDOMIZE_UNTIL not set in config.ini, continuing without randomization&#39;&#39;&#39;</span>
<span class="linenos">  37</span>
<span class="linenos">  38</span><span class="n">INVALID_VARIANCE_ERR_MSG</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="linenos">  39</span><span class="s1">VARIANCE_THRESHOLD &lt;= 0 as set in config.ini, continuing without randomization&#39;&#39;&#39;</span>
<span class="linenos">  40</span>
<span class="linenos">  41</span><span class="c1"># SEED_HARDWARE is the hardware file used as an initial template for the Circuits</span>
<span class="linenos">  42</span><span class="c1"># NOTE The Seed file is provided as a way to kickstart the evolutionary process</span>
<span class="linenos">  43</span><span class="c1"># without having to perform a time-consuming random search for a seedable circuit.</span>
<span class="linenos">  44</span><span class="c1"># Contact repository authors if you&#39;re interested in a new seed file.</span>
<span class="linenos">  45</span><span class="n">SEED_HARDWARE_FILEPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/seed-hardware.asc&quot;</span><span class="p">)</span>
<span class="linenos">  46</span>
<span class="linenos">  47</span><span class="c1"># The basename (filename without path or extensions) of the Circuit</span>
<span class="linenos">  48</span><span class="c1"># hardware, bitstream, and data files.</span>
<span class="linenos">  49</span><span class="n">CIRCUIT_FILE_BASENAME</span> <span class="o">=</span> <span class="s2">&quot;hardware&quot;</span>
<span class="linenos">  50</span>
<span class="linenos">  51</span><span class="n">ELITE_MAP_SCALE_FACTOR</span> <span class="o">=</span> <span class="mi">50</span>
<span class="linenos">  52</span>
<span class="linenos">  53</span><span class="c1"># Create a named tuple for easy and clear storage of information about</span>
<span class="linenos">  54</span><span class="c1"># a Circuit (currently its name and fitness)</span>
<span class="linenos">  55</span><span class="n">CircuitInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;CircuitInfo&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;fitness&quot;</span><span class="p">])</span>
<span class="linenos">  56</span>
<span class="linenos">  57</span><span class="c1"># Named tuple for circuit&#39;s path and fitness; currently only used for combining populations</span>
<span class="linenos">  58</span><span class="n">CircuitPathInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;CircuitPathInfo&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;fitness&quot;</span><span class="p">])</span>
<span class="linenos">  59</span>
<span class="linenos">  60</span><span class="c1"># Bin sizes for elite maps</span>
<span class="linenos">  61</span><span class="n">ELITE_MAP_SCALE_FACTOR</span> <span class="o">=</span> <span class="mi">50</span>
<span class="linenos">  62</span><span class="n">PULSE_ELITE_MAP_SCALE_FACTOR</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="linenos">  63</span>
<div class="viewcode-block" id="is_pulse_func">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.is_pulse_func">[docs]</a>
<span class="linenos">  64</span><span class="k">def</span><span class="w"> </span><span class="nf">is_pulse_func</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<span class="linenos">  65</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  66</span><span class="sd">    Used in multiple places, will be removed soon.</span>
<span class="linenos">  67</span>
<span class="linenos">  68</span><span class="sd">    .. todo::</span>
<span class="linenos">  69</span><span class="sd">        unite the is_pulse_func() functions for ease of change.</span>
<span class="linenos">  70</span>
<span class="linenos">  71</span><span class="sd">    Parameters</span>
<span class="linenos">  72</span><span class="sd">    ----------</span>
<span class="linenos">  73</span><span class="sd">    config : Config</span>
<span class="linenos">  74</span><span class="sd">        Configuration Class to interact with config</span>
<span class="linenos">  75</span>
<span class="linenos">  76</span><span class="sd">    Returns</span>
<span class="linenos">  77</span><span class="sd">    -------</span>
<span class="linenos">  78</span><span class="sd">    bool</span>
<span class="linenos">  79</span><span class="sd">        True if it is any type of oscilator (uses count pulses), False otherwise.</span>
<span class="linenos">  80</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">  81</span>    <span class="k">return</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PULSE_COUNT&#39;</span> <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;TOLERANT_PULSE_COUNT&#39;</span> 
<span class="linenos">  82</span>            <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;SENSITIVE_PULSE_COUNT&#39;</span> <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PULSE_CONSISTENCY&#39;</span><span class="p">)</span></div>

<span class="linenos">  83</span>
<div class="viewcode-block" id="CircuitPopulation">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation">[docs]</a>
<span class="linenos">  84</span><span class="k">class</span><span class="w"> </span><span class="nc">CircuitPopulation</span><span class="p">:</span>
<span class="linenos">  85</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages the initializing the population of circuits,</span>
<span class="linenos">  86</span><span class="sd">    updating and recording information about the population throughout evolution,</span>
<span class="linenos">  87</span><span class="sd">    and deciding when to stop evolution&quot;&quot;&quot;</span>
<span class="linenos">  88</span>    <span class="c1"># SECTION Initialization functions</span>
<div class="viewcode-block" id="CircuitPopulation.__init__">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.__init__">[docs]</a>
<span class="linenos">  89</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcu</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
<span class="linenos">  90</span><span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="linenos">  91</span><span class="sd">        Generates the initial population of circuits with the following arguments</span>
<span class="linenos">  92</span>
<span class="linenos">  93</span><span class="sd">        Parameters</span>
<span class="linenos">  94</span><span class="sd">        ----------</span>
<span class="linenos">  95</span><span class="sd">        mcu : Microcontroller</span>
<span class="linenos">  96</span><span class="sd">            Object containing an instance of Microcontroller class</span>
<span class="linenos">  97</span><span class="sd">        config : Config</span>
<span class="linenos">  98</span><span class="sd">            Object containing an instance of Config class</span>
<span class="linenos">  99</span><span class="sd">        logger : Logger</span>
<span class="linenos"> 100</span><span class="sd">            Object containing an instance of Logger class</span>
<span class="linenos"> 101</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 102</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="n">config</span>
<span class="linenos"> 103</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__microcontroller</span> <span class="o">=</span> <span class="n">mcu</span>
<span class="linenos"> 104</span>
<span class="linenos"> 105</span>        <span class="c1"># A list of Circuits that&#39;s sorted by fitness decreasing order</span>
<span class="linenos"> 106</span>        <span class="c1"># (to get it to sort in decreasing order I had to multiply the</span>
<span class="linenos"> 107</span>        <span class="c1"># sort key by negative one to reverse the natural sorting order</span>
<span class="linenos"> 108</span>        <span class="c1"># since sortedcontainers don&#39;t have a way to be in reverse order).</span>
<span class="linenos"> 109</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span> <span class="o">=</span> <span class="n">SortedKeyList</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ckt</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">())</span>
<span class="linenos"> 110</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="n">logger</span>
<span class="linenos"> 111</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__overall_best_circuit_info</span> <span class="o">=</span> <span class="n">CircuitInfo</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 112</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
<span class="linenos"> 113</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 114</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__best_epoch</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 115</span>        <span class="n">num_rows</span> <span class="o">=</span> <span class="mi">3</span>
<span class="linenos"> 116</span>        <span class="k">if</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_routing_type</span> <span class="o">==</span> <span class="s2">&quot;NEWSE&quot;</span><span class="p">):</span>
<span class="linenos"> 117</span>            <span class="n">num_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos"> 118</span>        <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_accessed_columns</span><span class="p">())</span>
<span class="linenos"> 119</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__population_bistream_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">16</span><span class="o">*</span><span class="mi">6</span><span class="o">*</span><span class="n">num_rows</span><span class="o">*</span><span class="n">num_cols</span><span class="p">)</span>
<span class="linenos"> 120</span>
<span class="linenos"> 121</span>        <span class="c1"># Set the selection type here since the selection type should</span>
<span class="linenos"> 122</span>        <span class="c1"># not change during a run. This way we don&#39;t have to branch each</span>
<span class="linenos"> 123</span>        <span class="c1"># time we run selection.</span>
<span class="linenos"> 124</span>        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get_selection_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;SINGLE_ELITE&quot;</span><span class="p">:</span>
<span class="linenos"> 125</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_single_elite_tournament</span>
<span class="linenos"> 126</span>        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get_selection_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FRAC_ELITE&quot;</span><span class="p">:</span>
<span class="linenos"> 127</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_fractional_elite_tournament</span>
<span class="linenos"> 128</span>        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get_selection_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;CLASSIC_TOURN&quot;</span><span class="p">:</span>
<span class="linenos"> 129</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_classic_tournament</span>
<span class="linenos"> 130</span>        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get_selection_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FIT_PROP_SEL&quot;</span><span class="p">:</span>
<span class="linenos"> 131</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_fitness_proportional_selection</span>
<span class="linenos"> 132</span>        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get_selection_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;RANK_PROP_SEL&quot;</span><span class="p">:</span>
<span class="linenos"> 133</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_rank_proportional_selection</span>
<span class="linenos"> 134</span>        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get_selection_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;MAP_ELITES&quot;</span><span class="p">:</span>
<span class="linenos"> 135</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_map_elites_selection</span>
<span class="linenos"> 136</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 137</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_error</span><span class="p">(</span>
<span class="linenos"> 138</span>                <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Invalid Selection method in config.ini. Exiting...&quot;</span><span class="p">)</span>
<span class="linenos"> 139</span>            <span class="n">exit</span><span class="p">()</span>
<span class="linenos"> 140</span>
<span class="linenos"> 141</span>        <span class="n">elitism_fraction</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_elitism_fraction</span><span class="p">()</span>
<span class="linenos"> 142</span>        <span class="n">population_size</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_population_size</span><span class="p">()</span>
<span class="linenos"> 143</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">elitism_fraction</span> <span class="o">*</span> <span class="n">population_size</span><span class="p">))</span></div>

<span class="linenos"> 144</span>
<div class="viewcode-block" id="CircuitPopulation.run_fitness_sensitity">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.run_fitness_sensitity">[docs]</a>
<span class="linenos"> 145</span>    <span class="k">def</span><span class="w"> </span><span class="nf">run_fitness_sensitity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 146</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 147</span><span class="sd">        Gets the same circuit, runs it repeatedly and reports each fitness.</span>
<span class="linenos"> 148</span><span class="sd">        Internally has a while loop to determine how many times to run.</span>
<span class="linenos"> 149</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 150</span>        <span class="c1">#create circuit object</span>
<span class="linenos"> 151</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Creating circuit object for fitness sensitivity experiment&quot;</span><span class="p">)</span>
<span class="linenos"> 152</span>        <span class="n">ckt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__construct_circuit</span><span class="p">(</span>
<span class="linenos"> 153</span>            <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 154</span>            <span class="s2">&quot;hardware1&quot;</span><span class="p">,</span>
<span class="linenos"> 155</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_test_circuit</span><span class="p">(),</span>
<span class="linenos"> 156</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__generate_sine_funcs</span><span class="p">()</span>
<span class="linenos"> 157</span>        <span class="p">)</span>
<span class="linenos"> 158</span>
<span class="linenos"> 159</span>        <span class="n">using_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">using_sensitivity_time</span><span class="p">()</span>
<span class="linenos"> 160</span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="linenos"> 161</span>        <span class="n">stop_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_sensitivity_time</span><span class="p">()</span>
<span class="linenos"> 162</span>
<span class="linenos"> 163</span>        <span class="n">using_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">using_sensitivity_trials</span><span class="p">()</span>
<span class="linenos"> 164</span>        <span class="n">cur_trial</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 165</span>        <span class="n">num_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_sensitivity_trials</span><span class="p">()</span>
<span class="linenos"> 166</span>        
<span class="linenos"> 167</span>        <span class="c1">#loop through trials and log fitness</span>
<span class="linenos"> 168</span>        <span class="n">should_continue</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 169</span>        <span class="k">while</span> <span class="n">should_continue</span><span class="p">:</span>
<span class="linenos"> 170</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__eval_circuit_once</span><span class="p">(</span><span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 171</span>            <span class="n">fitness</span> <span class="o">=</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 172</span>
<span class="linenos"> 173</span>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/fitnesssensitivity.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live_file</span><span class="p">:</span>
<span class="linenos"> 174</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">is_pulse_func</span><span class="p">():</span>
<span class="linenos"> 175</span>                    <span class="n">data2</span> <span class="o">=</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_extra_data</span><span class="p">(</span><span class="s1">&#39;pulses&#39;</span><span class="p">)</span>
<span class="linenos"> 176</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 177</span>                    <span class="n">data2</span> <span class="o">=</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_extra_data</span><span class="p">(</span><span class="s1">&#39;mean_voltage&#39;</span><span class="p">)</span>
<span class="linenos"> 178</span>
<span class="linenos"> 179</span>                <span class="c1">#get temp and humidity reading</span>
<span class="linenos"> 180</span>                <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 181</span>                <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 182</span>                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">reading_temp_humidity</span><span class="p">()):</span>
<span class="linenos"> 183</span>                    <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__microcontroller</span><span class="o">.</span><span class="n">measure_temp</span><span class="p">()</span>
<span class="linenos"> 184</span>                    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__microcontroller</span><span class="o">.</span><span class="n">measure_humidity</span><span class="p">()</span>
<span class="linenos"> 185</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Recorded temperature: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;. Recorded humidity: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
<span class="linenos"> 186</span>
<span class="linenos"> 187</span>                
<span class="linenos"> 188</span>                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="linenos"> 189</span>                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H.%M.%S&quot;</span><span class="p">)</span>
<span class="linenos"> 190</span>
<span class="linenos"> 191</span>                <span class="n">live_file</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cur_trial</span><span class="p">),</span> <span class="n">fitness</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
<span class="linenos"> 192</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Trial &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_trial</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; done. Fitness recorded and logged to file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fitness</span><span class="p">))</span>
<span class="linenos"> 193</span>
<span class="linenos"> 194</span>            <span class="n">cur_trial</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 195</span>            <span class="n">should_continue</span> <span class="o">=</span> <span class="p">((</span><span class="ow">not</span> <span class="n">using_time</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">stop_time</span><span class="p">))</span> <span class="ow">and</span> \
<span class="linenos"> 196</span>                              <span class="p">((</span><span class="ow">not</span> <span class="n">using_trials</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cur_trial</span> <span class="o">&lt;</span> <span class="n">num_trials</span><span class="p">))</span>
<span class="linenos"> 197</span>
<span class="linenos"> 198</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fitness sensitivity trails done.&quot;</span><span class="p">)</span></div>

<span class="linenos"> 199</span>
<span class="linenos"> 200</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__generate_sine_funcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 201</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 202</span><span class="sd">        Builds a list of randomly generated sine functions used in the simulation mode.</span>
<span class="linenos"> 203</span>
<span class="linenos"> 204</span><span class="sd">        Returns</span>
<span class="linenos"> 205</span><span class="sd">        -------</span>
<span class="linenos"> 206</span><span class="sd">        list[functions]</span>
<span class="linenos"> 207</span><span class="sd">            List of randomly generated sine functions</span>
<span class="linenos"> 208</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 209</span>        <span class="n">sine_funcs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 210</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__sine_strs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 211</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
<span class="linenos"> 212</span>            <span class="c1"># Don&#39;t let amplitude and y-offset get too out of hand</span>
<span class="linenos"> 213</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 214</span>            <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="linenos"> 215</span>            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>
<span class="linenos"> 216</span>            <span class="n">d</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="linenos"> 217</span>            <span class="c1"># We provide many parameters with default values here, because Python closures</span>
<span class="linenos"> 218</span>            <span class="c1"># work like JS using the &quot;var&quot; keyword, and do not &quot;properly&quot; create environments the way we&#39;d expect</span>
<span class="linenos"> 219</span>            <span class="c1"># For this reason, we add default parameters, providing our current var values to them</span>
<span class="linenos"> 220</span>            <span class="c1"># This works because the variable values are then *evaluated* as the lambda (closure) is constructed</span>
<span class="linenos"> 221</span>            <span class="c1"># Before this fix, we had a bug where every single sine function would be exactly the same;</span>
<span class="linenos"> 222</span>            <span class="c1"># all holding a/b/c/d values from the very last function to be generated</span>
<span class="linenos"> 223</span>            <span class="n">sine_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">))</span> <span class="o">+</span> <span class="n">d</span><span class="p">))</span>
<span class="linenos"> 224</span>            <span class="n">sine_str</span> <span class="o">=</span> <span class="s2">&quot;Sine function: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; | y = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; * sin(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; * (x + &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)) + &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="linenos"> 225</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__sine_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sine_str</span><span class="p">)</span>
<span class="linenos"> 226</span>        <span class="k">return</span> <span class="n">sine_funcs</span>
<span class="linenos"> 227</span>
<span class="linenos"> 228</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__construct_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">seed_arg</span><span class="p">,</span> <span class="n">sine_funcs</span><span class="p">):</span>
<span class="linenos"> 229</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FULLY_SIM&#39;</span><span class="p">:</span>
<span class="linenos"> 230</span>            <span class="k">return</span> <span class="n">FullySimCircuit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">,</span> <span class="n">sine_funcs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="p">)</span>
<span class="linenos"> 231</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;SIM_HARDWARE&#39;</span><span class="p">:</span>
<span class="linenos"> 232</span>            <span class="k">return</span> <span class="n">SimHardwareCircuit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">,</span> <span class="n">seed_arg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="p">)</span>
<span class="linenos"> 233</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 234</span>            <span class="n">fit_func</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 235</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;VARIANCE&#39;</span><span class="p">:</span>
<span class="linenos"> 236</span>                <span class="n">fit_func</span> <span class="o">=</span> <span class="n">VarMaxFitnessFunction</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="linenos"> 237</span>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PULSE_COUNT&#39;</span><span class="p">,</span> <span class="s1">&#39;SENSITIVE_PULSE_COUNT&#39;</span><span class="p">,</span> <span class="s1">&#39;TOLERANT_PULSE_COUNT&#39;</span><span class="p">]:</span>
<span class="linenos"> 238</span>                <span class="n">fit_func</span> <span class="o">=</span> <span class="n">PulseCountFitnessFunction</span><span class="p">()</span>
<span class="linenos"> 239</span>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;TONE_DISCRIMINATOR&#39;</span><span class="p">:</span>
<span class="linenos"> 240</span>                <span class="n">fit_func</span> <span class="o">=</span> <span class="n">ToneDiscriminatorFitnessFunction</span><span class="p">()</span>
<span class="linenos"> 241</span>
<span class="linenos"> 242</span>            <span class="k">return</span> <span class="n">IntrinsicCircuit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">,</span> <span class="n">seed_arg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__microcontroller</span><span class="p">,</span> <span class="n">fit_func</span><span class="p">)</span>
<span class="linenos"> 243</span>
<div class="viewcode-block" id="CircuitPopulation.populate">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.populate">[docs]</a>
<span class="linenos"> 244</span>    <span class="k">def</span><span class="w"> </span><span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 245</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 246</span><span class="sd">        Creates initial population based on the config.</span>
<span class="linenos"> 247</span><span class="sd">        1. Clears the files used to keep track of circuit</span>
<span class="linenos"> 248</span><span class="sd">        2. Uses appropriate initialization method specified by config.</span>
<span class="linenos"> 249</span><span class="sd">        3. Handles randomization until condition in config is met.</span>
<span class="linenos"> 250</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 251</span>        <span class="c1"># Always creates a circuit with the seed file, but if we have certain randomization</span>
<span class="linenos"> 252</span>        <span class="c1"># modes then perform necessary operations</span>
<span class="linenos"> 253</span>        <span class="n">sine_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__generate_sine_funcs</span><span class="p">()</span>
<span class="linenos"> 254</span>
<span class="linenos"> 255</span>        <span class="c1"># Wipe the current folder, so if we go from 100 circuits in one experiment to 50 in the next,</span>
<span class="linenos"> 256</span>        <span class="c1"># we don&#39;t still have 100 (with 50 that we use and 50 residual ones)</span>
<span class="linenos"> 257</span>        <span class="n">wipe_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_asc_directory</span><span class="p">())</span>
<span class="linenos"> 258</span>        <span class="n">wipe_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_bin_directory</span><span class="p">())</span>
<span class="linenos"> 259</span>        <span class="n">wipe_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_data_directory</span><span class="p">())</span>
<span class="linenos"> 260</span>        <span class="n">wipe_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_generations_directory</span><span class="p">())</span>
<span class="linenos"> 261</span>
<span class="linenos"> 262</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__multiple_populations</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 263</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_init_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;EXISTING_POPULATION&quot;</span><span class="p">:</span>
<span class="linenos"> 264</span>            <span class="c1"># Need to assign where each circuit gets its source from</span>
<span class="linenos"> 265</span>            <span class="c1"># Get number of subpopulations, then grab random circuits from each</span>
<span class="linenos"> 266</span>            <span class="n">subdirectories</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_src_pops_dir</span><span class="p">()))[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 267</span>            <span class="n">subdirectory_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="nb">dir</span><span class="p">:</span> <span class="nb">next</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_src_pops_dir</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="nb">dir</span><span class="p">)))[</span><span class="mi">2</span><span class="p">],</span> <span class="n">subdirectories</span><span class="p">))</span>
<span class="linenos"> 268</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__num_subpops</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdirectories</span><span class="p">)</span>
<span class="linenos"> 269</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__multiple_populations</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 270</span>            <span class="c1"># Existing population setting, load in all circuits from each population and get the ones with the highest fitness</span>
<span class="linenos"> 271</span>            <span class="c1"># If any are missing the fitness measure, then we will randomly select them.</span>
<span class="linenos"> 272</span>            <span class="c1"># We could manually measure their fitnesses, but as of now we&#39;ve decided that is too slow</span>
<span class="linenos"> 273</span>            <span class="n">all_subdir_circuits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 274</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subdirectories</span><span class="p">)):</span>
<span class="linenos"> 275</span>                <span class="c1"># Load every circuit</span>
<span class="linenos"> 276</span>                <span class="n">subdir_circuits</span> <span class="o">=</span> <span class="n">SortedKeyList</span><span class="p">(</span>
<span class="linenos"> 277</span>                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ckt</span><span class="p">:</span> <span class="o">-</span><span class="n">ckt</span><span class="o">.</span><span class="n">fitness</span>
<span class="linenos"> 278</span>                <span class="p">)</span>
<span class="linenos"> 279</span>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">subdirectory_files</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<span class="linenos"> 280</span>                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_src_pops_dir</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">subdirectories</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="linenos"> 281</span>                    <span class="n">hw_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span>
<span class="linenos"> 282</span>                    <span class="n">mmapped_file</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="n">hw_file</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 283</span>                    <span class="n">hw_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos"> 284</span>                    <span class="n">fitness</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">FileBasedCircuit</span><span class="o">.</span><span class="n">get_file_attribute_st</span><span class="p">(</span><span class="n">mmapped_file</span><span class="p">,</span> <span class="s2">&quot;fitness&quot;</span><span class="p">))</span>
<span class="linenos"> 285</span>                    <span class="k">if</span> <span class="n">fitness</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 286</span>                        <span class="n">fitness</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 287</span>                    <span class="n">subdir_circuits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CircuitPathInfo</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fitness</span><span class="p">))</span>
<span class="linenos"> 288</span>
<span class="linenos"> 289</span>                <span class="n">all_subdir_circuits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdir_circuits</span><span class="p">)</span>
<span class="linenos"> 290</span>        <span class="n">subdirectory_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 291</span>
<span class="linenos"> 292</span>        <span class="c1"># if we&#39;re using custom i/o pin configurations</span>
<span class="linenos"> 293</span>        <span class="c1"># need to configure to io tiles of the seed circuit</span>
<span class="linenos"> 294</span>        <span class="n">template</span> <span class="o">=</span> <span class="n">SEED_HARDWARE_FILEPATH</span>
<span class="linenos"> 295</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_using_configurable_io</span><span class="p">():</span>
<span class="linenos"> 296</span>            <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;workspace/template/seed.asc&quot;</span>
<span class="linenos"> 297</span>            <span class="n">template_builder</span> <span class="o">=</span> <span class="n">ascTemplateBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="p">)</span>
<span class="linenos"> 298</span>            <span class="n">template_builder</span><span class="o">.</span><span class="n">configure_seed_io</span><span class="p">(</span><span class="n">SEED_HARDWARE_FILEPATH</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
<span class="linenos"> 299</span>
<span class="linenos"> 300</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_population_size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 301</span>            <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;hardware&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="linenos"> 302</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_init_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;EXISTING_POPULATION&quot;</span><span class="p">:</span>
<span class="linenos"> 303</span>                <span class="c1"># Grab the top circuit from the current population, unless it is empty, then we&#39;ll jump to the next one</span>
<span class="linenos"> 304</span>                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_subdir_circuits</span><span class="p">[</span><span class="n">subdirectory_index</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 305</span>                    <span class="n">subdirectory_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">subdirectory_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_subdir_circuits</span><span class="p">)</span>
<span class="linenos"> 306</span>                <span class="n">seedArg</span> <span class="o">=</span> <span class="n">all_subdir_circuits</span><span class="p">[</span><span class="n">subdirectory_index</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
<span class="linenos"> 307</span>                <span class="n">subdirectory_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">subdirectory_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_subdir_circuits</span><span class="p">)</span>
<span class="linenos"> 308</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 309</span>                <span class="n">seedArg</span> <span class="o">=</span> <span class="n">template</span>
<span class="linenos"> 310</span>
<span class="linenos"> 311</span>            <span class="n">ckt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__construct_circuit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">seedArg</span><span class="p">,</span> <span class="n">sine_funcs</span><span class="p">)</span>
<span class="linenos"> 312</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_init_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;RANDOM&quot;</span><span class="p">:</span>
<span class="linenos"> 313</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">randomize_bitstream</span><span class="p">()</span>
<span class="linenos"> 314</span>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_init_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;CLONE_SEED_MUTATE&quot;</span><span class="p">:</span>
<span class="linenos"> 315</span>                <span class="c1"># Call mutate once on this circuit</span>
<span class="linenos"> 316</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 317</span>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_init_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;EXISTING_POPULATION&quot;</span><span class="p">:</span>
<span class="linenos"> 318</span>                <span class="c1"># Make sure the circuit puts a line at the top of its .asc file denoting the source population</span>
<span class="linenos"> 319</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">set_file_attribute</span><span class="p">(</span><span class="s1">&#39;src_population&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">subdirectory_index</span><span class="p">))</span>
<span class="linenos"> 320</span>
<span class="linenos"> 321</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 322</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Created circuit: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ckt</span><span class="p">))</span>
<span class="linenos"> 323</span>
<span class="linenos"> 324</span>        <span class="c1"># If map-elites selection method selected, then randomly generate until we fill up 25% of the map</span>
<span class="linenos"> 325</span><span class="w">        </span><span class="sd">&#39;&#39;&#39;if self.__config.get_selection_type() == &#39;MAP_ELITES&#39;:</span>
<span class="linenos"> 326</span><span class="sd">            self.__log_event(1, &#39;Randomizing until map is 25% full...&#39;)</span>
<span class="linenos"> 327</span><span class="sd">            elites = list(filter(lambda x: x != 0, [j for sub in self.__generate_map() for j in sub]))</span>
<span class="linenos"> 328</span><span class="sd">            elite_count = len(elites)</span>
<span class="linenos"> 329</span><span class="sd">            while elite_count &lt; 0.1 * (21 * 21 / 2):</span>
<span class="linenos"> 330</span><span class="sd">                self.__log_event(3, &quot;Got %s%% (%s)&quot; % (elite_count / (21*21/2) * 100, elite_count))</span>
<span class="linenos"> 331</span><span class="sd">                # Need to mutate non-elites</span>
<span class="linenos"> 332</span><span class="sd">                for ckt in self.__circuits:</span>
<span class="linenos"> 333</span><span class="sd">                    if not ckt in elites:</span>
<span class="linenos"> 334</span><span class="sd">                        ckt.copy_sim(random.choice(elites))</span>
<span class="linenos"> 335</span><span class="sd">                        ckt.mutate()</span>
<span class="linenos"> 336</span><span class="sd">                        #ckt.randomize_bitstream()</span>
<span class="linenos"> 337</span><span class="sd">                        ckt.evaluate_sim(False)</span>
<span class="linenos"> 338</span>
<span class="linenos"> 339</span><span class="sd">                elite_map = self.__generate_map()</span>
<span class="linenos"> 340</span><span class="sd">                elites = list(filter(lambda x: x != 0, [j for sub in elite_map for j in sub]))</span>
<span class="linenos"> 341</span><span class="sd">                elite_count = len(elites)</span>
<span class="linenos"> 342</span><span class="sd">                self.__output_map_file(elite_map)&#39;&#39;&#39;</span>
<span class="linenos"> 343</span>
<span class="linenos"> 344</span>        <span class="c1"># Randomize initial circuits until waveform variance or</span>
<span class="linenos"> 345</span>        <span class="c1"># pulses are found</span>
<span class="linenos"> 346</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;FULLY_INTRINSIC&quot;</span><span class="p">:</span>
<span class="linenos"> 347</span>            <span class="k">pass</span> <span class="c1"># No randomization implemented for simulation mode</span>
<span class="linenos"> 348</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomization_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PULSE&quot;</span><span class="p">:</span>
<span class="linenos"> 349</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;PULSE randomization mode selected.&quot;</span><span class="p">)</span>
<span class="linenos"> 350</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__randomize_until_pulses</span><span class="p">()</span>
<span class="linenos"> 351</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomization_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;VARIANCE&quot;</span><span class="p">:</span>
<span class="linenos"> 352</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;VARIANCE randomization mode selected.&quot;</span><span class="p">)</span>
<span class="linenos"> 353</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomize_threshold</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 354</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__log_error</span><span class="p">(</span><span class="n">INVALID_VARIANCE_ERR_MSG</span><span class="p">)</span>
<span class="linenos"> 355</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 356</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__randomize_until_variance</span><span class="p">()</span>
<span class="linenos"> 357</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomization_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;VOLTAGE&quot;</span><span class="p">:</span>
<span class="linenos"> 358</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__randomize_until_voltage</span><span class="p">()</span>
<span class="linenos"> 359</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomization_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;NO&quot;</span><span class="p">:</span>
<span class="linenos"> 360</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;NO randomization mode selected.&quot;</span><span class="p">)</span>
<span class="linenos"> 361</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 362</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_error</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">RANDOMIZE_UNTIL_NOT_SET_ERR_MSG</span><span class="p">)</span>
<span class="linenos"> 363</span>
<span class="linenos"> 364</span>        <span class="c1"># Output the first data point to live data files</span>
<span class="linenos"> 365</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__write_to_livedata</span><span class="p">()</span></div>

<span class="linenos"> 366</span>
<span class="linenos"> 367</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__randomize_until_pulses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 368</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 369</span><span class="sd">        Randomizes population until minimum number of pulses is found.</span>
<span class="linenos"> 370</span><span class="sd">        Called by populate(self)</span>
<span class="linenos"> 371</span><span class="sd">        Should only be used with pulse count fitness functions</span>
<span class="linenos"> 372</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 373</span>        <span class="n">no_pulses_generated</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 374</span>        <span class="k">while</span> <span class="n">no_pulses_generated</span><span class="p">:</span>
<span class="linenos"> 375</span>            <span class="c1"># NOTE Randomize until pulses will continue mutating and</span>
<span class="linenos"> 376</span>            <span class="c1"># not revert to the original seed-hardware until restarting</span>
<span class="linenos"> 377</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Randomizing to generate pulses&quot;</span><span class="p">)</span>
<span class="linenos"> 378</span>            <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 379</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomize_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;RANDOM&#39;</span><span class="p">:</span>
<span class="linenos"> 380</span>                    <span class="n">circuit</span><span class="o">.</span><span class="n">randomize_bitstream</span><span class="p">()</span>
<span class="linenos"> 381</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 382</span>                    <span class="n">circuit</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 383</span>
<span class="linenos"> 384</span>                <span class="n">circuit</span><span class="o">.</span><span class="n">evaluate_once</span><span class="p">()</span>
<span class="linenos"> 385</span>                <span class="n">pulses</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_extra_data</span><span class="p">(</span><span class="s1">&#39;pulses&#39;</span><span class="p">)</span>
<span class="linenos"> 386</span>                <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomize_threshold</span><span class="p">()</span>
<span class="linenos"> 387</span>                <span class="k">if</span> <span class="p">(</span><span class="n">pulses</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">):</span>
<span class="linenos"> 388</span>                    <span class="n">no_pulses_generated</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 389</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Pulse generated! Exiting randomization. Pulses recorded:&quot;</span><span class="p">,</span> <span class="n">pulses</span><span class="p">)</span>
<span class="linenos"> 390</span>                    <span class="k">break</span>
<span class="linenos"> 391</span>    
<span class="linenos"> 392</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__randomize_until_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 393</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 394</span><span class="sd">        Randomizes population until a mean voltage is found near the desired value</span>
<span class="linenos"> 395</span><span class="sd">        called by populate(self)</span>
<span class="linenos"> 396</span><span class="sd">        Should only be used with variance maximization fitness function</span>
<span class="linenos"> 397</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 398</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 399</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Randomizing to get voltage&quot;</span><span class="p">)</span>
<span class="linenos"> 400</span>            <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 401</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomize_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;RANDOM&#39;</span><span class="p">:</span>
<span class="linenos"> 402</span>                    <span class="n">circuit</span><span class="o">.</span><span class="n">randomize_bitstream</span><span class="p">()</span>
<span class="linenos"> 403</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 404</span>                    <span class="n">circuit</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 405</span>
<span class="linenos"> 406</span>                <span class="n">circuit</span><span class="o">.</span><span class="n">evaluate_once</span><span class="p">()</span>
<span class="linenos"> 407</span>                <span class="n">mean_voltage</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_extra_data</span><span class="p">(</span><span class="s1">&#39;mean_voltage&#39;</span><span class="p">)</span>
<span class="linenos"> 408</span>                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mean_voltage</span> <span class="o">-</span> <span class="mi">341</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>
<span class="linenos"> 409</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Voltage Achieved! Exiting randomization. Voltage:&quot;</span><span class="p">,</span> <span class="n">mean_voltage</span><span class="p">)</span>
<span class="linenos"> 410</span>                    <span class="k">break</span>
<span class="linenos"> 411</span>
<span class="linenos"> 412</span>    <span class="c1"># NOTE This is whole function going to be upgraded to handle a from-scratch circuit seeding process.</span>
<span class="linenos"> 413</span>    <span class="c1"># https://github.com/evolvablehardware/BitstreamEvolution/issues/3</span>
<span class="linenos"> 414</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__randomize_until_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 415</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 416</span><span class="sd">        Randomizes population until minimum variance fitness is found.</span>
<span class="linenos"> 417</span><span class="sd">        called by populate(self)</span>
<span class="linenos"> 418</span><span class="sd">        Should only be used with variance maximization fitness function</span>
<span class="linenos"> 419</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 420</span>        <span class="c1"># Variance threshold is the desired variance</span>
<span class="linenos"> 421</span>        <span class="n">bestVariance</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 422</span>        <span class="n">variance</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 423</span>        <span class="k">while</span> <span class="n">bestVariance</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_randomize_threshold</span><span class="p">():</span>
<span class="linenos"> 424</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Randomizing to generate variance&quot;</span><span class="p">)</span>
<span class="linenos"> 425</span>            <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 426</span>                <span class="n">circuit</span><span class="o">.</span><span class="n">randomize_bitstream</span><span class="p">()</span>
<span class="linenos"> 427</span>                <span class="n">circuit</span><span class="o">.</span><span class="n">evaluate_once</span><span class="p">()</span>
<span class="linenos"> 428</span>                <span class="n">variance</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 429</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Variance generated:&quot;</span><span class="p">,</span> <span class="n">variance</span><span class="p">)</span>
<span class="linenos"> 430</span>
<span class="linenos"> 431</span>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/randomizationdata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">liveFile</span><span class="p">:</span>
<span class="linenos"> 432</span>                    <span class="n">liveFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 433</span>
<span class="linenos"> 434</span>                <span class="k">if</span> <span class="n">variance</span> <span class="o">&gt;</span> <span class="n">bestVariance</span><span class="p">:</span>
<span class="linenos"> 435</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;New best variance: &quot;</span><span class="p">,</span> <span class="n">variance</span><span class="p">)</span>
<span class="linenos"> 436</span>                    <span class="n">bestVariance</span> <span class="o">=</span> <span class="n">variance</span>
<span class="linenos"> 437</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__overall_best_circuit_info</span> <span class="o">=</span> <span class="n">CircuitInfo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">circuit</span><span class="p">),</span> <span class="n">variance</span><span class="p">)</span>
<span class="linenos"> 438</span>                    <span class="n">copyfile</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">get_hardware_file_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_best_file</span><span class="p">())</span>
<span class="linenos"> 439</span>                    <span class="k">break</span>
<span class="linenos"> 440</span>
<span class="linenos"> 441</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Variance generated! Exiting randomization. Fitness:&quot;</span><span class="p">,</span> <span class="n">variance</span><span class="p">)</span>
<span class="linenos"> 442</span>
<span class="linenos"> 443</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__next_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 444</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 445</span><span class="sd">        Moves to the next generation/epoch</span>
<span class="linenos"> 446</span><span class="sd">        Currently, only needs to increase the generation by 1</span>
<span class="linenos"> 447</span><span class="sd">        All other generation-specific behavior will be derived from this value</span>
<span class="linenos"> 448</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 449</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 450</span>
<span class="linenos"> 451</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__should_continue_evo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 452</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 453</span><span class="sd">        Checks with config whether we have reached any of the end conditions for the simulation run.</span>
<span class="linenos"> 454</span>
<span class="linenos"> 455</span><span class="sd">        Returns</span>
<span class="linenos"> 456</span><span class="sd">        -------</span>
<span class="linenos"> 457</span><span class="sd">        bool</span>
<span class="linenos"> 458</span><span class="sd">            True if evolution should continue, False otherwise.</span>
<span class="linenos"> 459</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 460</span>        <span class="n">should_continue</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 461</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">using_n_generations</span><span class="p">():</span>
<span class="linenos"> 462</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_n_generations</span><span class="p">():</span>
<span class="linenos"> 463</span>                <span class="n">should_continue</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 464</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">using_target_fitness</span><span class="p">():</span>
<span class="linenos"> 465</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__overall_best_circuit_info</span><span class="o">.</span><span class="n">fitness</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_target_fitness</span><span class="p">():</span>
<span class="linenos"> 466</span>                <span class="n">should_continue</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 467</span>        <span class="k">return</span> <span class="n">should_continue</span>
<span class="linenos"> 468</span>
<span class="linenos"> 469</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__eval_circuit_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circuit</span><span class="p">):</span>
<span class="linenos"> 470</span>        <span class="n">circuit</span><span class="o">.</span><span class="n">clear_data</span><span class="p">()</span>
<span class="linenos"> 471</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">FileBasedCircuit</span><span class="p">):</span>
<span class="linenos"> 472</span>            <span class="n">circuit</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>
<span class="linenos"> 473</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_num_samples</span><span class="p">()):</span>
<span class="linenos"> 474</span>            <span class="n">circuit</span><span class="o">.</span><span class="n">collect_data_once</span><span class="p">()</span>
<span class="linenos"> 475</span>
<span class="linenos"> 476</span>        <span class="n">circuit</span><span class="o">.</span><span class="n">calculate_fitness</span><span class="p">()</span>
<span class="linenos"> 477</span>
<div class="viewcode-block" id="CircuitPopulation.evolve">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.evolve">[docs]</a>
<span class="linenos"> 478</span>    <span class="k">def</span><span class="w"> </span><span class="nf">evolve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 479</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 480</span><span class="sd">        Runs an evolutionary loop and records the circuit with the highest fitness throughout the loop,</span>
<span class="linenos"> 481</span><span class="sd">        while also storing statistics in a file for the plot to access.</span>
<span class="linenos"> 482</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 483</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 484</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_error</span><span class="p">(</span>
<span class="linenos"> 485</span>                <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Attempting to evolve with empty population. Exiting...&quot;</span><span class="p">)</span>
<span class="linenos"> 486</span>            <span class="n">exit</span><span class="p">()</span>
<span class="linenos"> 487</span>
<span class="linenos"> 488</span>        <span class="c1"># Set initial values for &#39;best&#39; data</span>
<span class="linenos"> 489</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__overall_best_circuit_info</span> <span class="o">=</span> <span class="n">CircuitInfo</span><span class="p">(</span>
<span class="linenos"> 490</span>            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<span class="linenos"> 491</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 492</span>        <span class="p">)</span>
<span class="linenos"> 493</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__best_epoch</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 494</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__next_epoch</span><span class="p">()</span>
<span class="linenos"> 495</span>
<span class="linenos"> 496</span>        <span class="k">while</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__should_continue_evo</span><span class="p">()):</span> <span class="c1">#self.get_current_epoch() &lt; self.__config.get_n_generations()):</span>
<span class="linenos"> 497</span>
<span class="linenos"> 498</span>            <span class="c1">#self.__log_event(3, &quot;Starting evo cycle&quot;, self.get_current_epoch(</span>
<span class="linenos"> 499</span>            <span class="c1">#), &quot;&lt;&quot;, self.__config.get_n_generations(), &quot;?&quot;)</span>
<span class="linenos"> 500</span>
<span class="linenos"> 501</span>            <span class="c1"># Since sortedcontainers don&#39;t update when the value by</span>
<span class="linenos"> 502</span>            <span class="c1"># which an item is sorted gets updated, we have to add the</span>
<span class="linenos"> 503</span>            <span class="c1"># Circuits to a new list after we evaluate them and then</span>
<span class="linenos"> 504</span>            <span class="c1"># make the new list the working Circuit list.</span>
<span class="linenos"> 505</span>            <span class="n">reevaulated_circuits</span> <span class="o">=</span> <span class="n">SortedKeyList</span><span class="p">(</span>
<span class="linenos"> 506</span>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ckt</span><span class="p">:</span> <span class="o">-</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 507</span>            <span class="p">)</span>
<span class="linenos"> 508</span>
<span class="linenos"> 509</span>            <span class="c1"># Evaluate all the Circuits in this CircuitPopulation.</span>
<span class="linenos"> 510</span>            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="linenos"> 511</span>
<span class="linenos"> 512</span>            <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 513</span>                <span class="n">circuit</span><span class="o">.</span><span class="n">clear_data</span><span class="p">()</span>
<span class="linenos"> 514</span>                
<span class="linenos"> 515</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_num_passes</span><span class="p">()):</span>
<span class="linenos"> 516</span>                <span class="c1"># Shuffle the circuits each time</span>
<span class="linenos"> 517</span>                <span class="n">circuits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos"> 518</span>                <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="n">circuits</span><span class="p">:</span>
<span class="linenos"> 519</span>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">FileBasedCircuit</span><span class="p">):</span>
<span class="linenos"> 520</span>                        <span class="n">circuit</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>
<span class="linenos"> 521</span>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_num_samples</span><span class="p">()):</span>
<span class="linenos"> 522</span>                        <span class="n">circuit</span><span class="o">.</span><span class="n">collect_data_once</span><span class="p">()</span>
<span class="linenos"> 523</span>
<span class="linenos"> 524</span>            <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 525</span>                <span class="n">circuit</span><span class="o">.</span><span class="n">calculate_fitness</span><span class="p">()</span>
<span class="linenos"> 526</span>
<span class="linenos"> 527</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__population_bistream_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__population_bistream_sum</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="linenos"> 528</span>            <span class="k">for</span> <span class="n">circuit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 529</span>                <span class="c1"># If evaluate returns true, then a circuit has surpassed</span>
<span class="linenos"> 530</span>                <span class="c1"># the threshold and we are done.</span>
<span class="linenos"> 531</span>
<span class="linenos"> 532</span>                <span class="c1"># fitness = circuit.get_fitness()</span>
<span class="linenos"> 533</span>                <span class="n">fitness</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 534</span>
<span class="linenos"> 535</span>                <span class="c1"># Save off various circuit metrics</span>
<span class="linenos"> 536</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;FULLY_SIM&#39;</span><span class="p">:</span>
<span class="linenos"> 537</span>                    <span class="n">circuit</span><span class="o">.</span><span class="n">set_file_attribute</span><span class="p">(</span><span class="s2">&quot;fitness&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fitness</span><span class="p">))</span>
<span class="linenos"> 538</span>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">is_pulse_count</span><span class="p">():</span>
<span class="linenos"> 539</span>                        <span class="n">circuit</span><span class="o">.</span><span class="n">set_file_attribute</span><span class="p">(</span><span class="s2">&quot;pulse_count&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">get_extra_data</span><span class="p">(</span><span class="s1">&#39;pulses&#39;</span><span class="p">)))</span>
<span class="linenos"> 540</span>
<span class="linenos"> 541</span>                <span class="c1"># Commented out for now while we test</span>
<span class="linenos"> 542</span>                <span class="c1"># Pretty sure this was originally for pulse count only, leaving it commented out since things are working right now</span>
<span class="linenos"> 543</span><span class="w">                </span><span class="sd">&#39;&#39;&#39;if fitness &gt; self.__config.get_randomize_threshold():</span>
<span class="linenos"> 544</span><span class="sd">                    self.__log_event(1, &quot;{} fitness: {}&quot;.format(circuit, fitness))</span>
<span class="linenos"> 545</span><span class="sd">                    return&#39;&#39;&#39;</span>
<span class="linenos"> 546</span>                <span class="n">reevaulated_circuits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
<span class="linenos"> 547</span>
<span class="linenos"> 548</span>                <span class="c1">#add the circuit&#39;s bistream to our population sum - for diversity calculation and visualization</span>
<span class="linenos"> 549</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;FULLY_SIM&#39;</span><span class="p">:</span>
<span class="linenos"> 550</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__population_bistream_sum</span> <span class="o">+=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_bitstream</span><span class="p">()</span>
<span class="linenos"> 551</span>
<span class="linenos"> 552</span>            <span class="n">epoch_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="linenos"> 553</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span> <span class="o">=</span> <span class="n">reevaulated_circuits</span>
<span class="linenos"> 554</span>
<span class="linenos"> 555</span>            <span class="c1"># If one of the new Circuits has a higher fitness than our</span>
<span class="linenos"> 556</span>            <span class="c1"># recorded best, make it the recorded best.</span>
<span class="linenos"> 557</span>            <span class="n">best_circuit_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_overall_best_circuit_info</span><span class="p">()</span>
<span class="linenos"> 558</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Best circuit info&quot;</span><span class="p">,</span> <span class="n">best_circuit_info</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>
<span class="linenos"> 559</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Circuit 0 info&quot;</span><span class="p">,</span>
<span class="linenos"> 560</span>                             <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">())</span>
<span class="linenos"> 561</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">best_circuit_info</span><span class="o">.</span><span class="n">fitness</span><span class="p">:</span>
<span class="linenos"> 562</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__overall_best_circuit_info</span> <span class="o">=</span> <span class="n">CircuitInfo</span><span class="p">(</span>
<span class="linenos"> 563</span>                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<span class="linenos"> 564</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 565</span>                <span class="p">)</span>
<span class="linenos"> 566</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__best_epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">()</span>
<span class="linenos"> 567</span>                <span class="c1"># Copy this circuit to the best file</span>
<span class="linenos"> 568</span>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FileBasedCircuit</span><span class="p">):</span>
<span class="linenos"> 569</span>                    <span class="n">copyfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_hardware_file_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_best_file</span><span class="p">())</span>
<span class="linenos"> 570</span>
<span class="linenos"> 571</span>                <span class="c1"># For tone discriminator experiments, update the best waveform and best state data</span>
<span class="linenos"> 572</span>                <span class="c1"># Each file will contain all sampled data points from the new best circuit</span>
<span class="linenos"> 573</span>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TONE_DISCRIMINATOR&quot;</span><span class="p">):</span>
<span class="linenos"> 574</span>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/bestwaveformlivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">waveLive</span><span class="p">:</span>
<span class="linenos"> 575</span>                        <span class="n">waveLive</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NEW BEST BELOW: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; in gen &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 576</span>                        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 577</span>                        <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_waveform_td</span><span class="p">():</span>
<span class="linenos"> 578</span>                            <span class="n">waveLive</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 579</span>                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 580</span>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/beststatelivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stateLive</span><span class="p">:</span>
<span class="linenos"> 581</span>                        <span class="n">stateLive</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NEW BEST BELOW: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; in gen &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 582</span>                        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 583</span>                        <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_state_td</span><span class="p">():</span>
<span class="linenos"> 584</span>                            <span class="n">stateLive</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 585</span>                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 586</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;New best found&quot;</span><span class="p">)</span>
<span class="linenos"> 587</span>
<span class="linenos"> 588</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">log_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch_time</span><span class="p">)</span>
<span class="linenos"> 589</span>            <span class="c1"># The circuits that are protected from randomization</span>
<span class="linenos"> 590</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__protected_elites</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 591</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_selection</span><span class="p">()</span>
<span class="linenos"> 592</span>
<span class="linenos"> 593</span>            <span class="c1"># Remove bottom X% of population to replace with random circuits</span>
<span class="linenos"> 594</span>            <span class="c1"># (just randomize bitstream of the bottom X%)</span>
<span class="linenos"> 595</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_random_injection</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 596</span>                <span class="n">amt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_random_injection</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_population_size</span><span class="p">())</span>
<span class="linenos"> 597</span>                <span class="n">circuits_to_randomize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="o">-</span><span class="n">amt</span><span class="p">:]</span>
<span class="linenos"> 598</span>                <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="n">circuits_to_randomize</span><span class="p">:</span>
<span class="linenos"> 599</span>                    <span class="k">if</span> <span class="n">ckt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__protected_elites</span><span class="p">:</span>
<span class="linenos"> 600</span>                        <span class="n">ckt</span><span class="o">.</span><span class="n">randomize_bitstream</span><span class="p">()</span>
<span class="linenos"> 601</span>
<span class="linenos"> 602</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__write_to_livedata</span><span class="p">()</span>
<span class="linenos"> 603</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__next_epoch</span><span class="p">()</span>
<span class="linenos"> 604</span>
<span class="linenos"> 605</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">using_transfer_interval</span><span class="p">():</span>
<span class="linenos"> 606</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_transfer_interval</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 607</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__microcontroller</span><span class="o">.</span><span class="n">switch_fpga</span><span class="p">()</span>
<span class="linenos"> 608</span>
<span class="linenos"> 609</span>        <span class="c1"># We have finished evolution! Lets quickly re-evaluate the top circuit, since it</span>
<span class="linenos"> 610</span>        <span class="c1"># will then output its waveform</span>
<span class="linenos"> 611</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_pulse_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">):</span>
<span class="linenos"> 612</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__eval_circuit_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos"> 613</span>        <span class="c1"># Also, log the name of the top circuit</span>
<span class="linenos"> 614</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Top Circuit in Final Generation:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<span class="linenos"> 615</span>
<span class="linenos"> 616</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__write_to_livedata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 617</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 618</span><span class="sd">        Runs each generation to write data to files used to store data needed for Live plots (PlotEvolutionLive.py)</span>
<span class="linenos"> 619</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 620</span>        <span class="n">fitness_sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 621</span>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 622</span>            <span class="n">fitness_sum</span> <span class="o">=</span> <span class="n">fitness_sum</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 623</span>        <span class="c1"># Calculate the diversity measure</span>
<span class="linenos"> 624</span>        <span class="n">diversity</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 625</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_diversity_measure</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;HAMMING_DIST&quot;</span><span class="p">:</span>
<span class="linenos"> 626</span>            <span class="n">diversity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_hamming_dist</span><span class="p">()</span>
<span class="linenos"> 627</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_diversity_measure</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;UNIQUE&quot;</span><span class="p">:</span>
<span class="linenos"> 628</span>            <span class="n">diversity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_unique</span><span class="p">()</span>
<span class="linenos"> 629</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_diversity_measure</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DIFFERING_BITS&quot;</span><span class="p">:</span>
<span class="linenos"> 630</span>            <span class="n">diversity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_differing_bits</span><span class="p">()</span>
<span class="linenos"> 631</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_diversity_measure</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
<span class="linenos"> 632</span>            <span class="n">diversity</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 633</span>        <span class="c1"># Providing any invalid measure of diversity will make it constantly 0</span>
<span class="linenos"> 634</span>        <span class="c1"># Write the generation data (avg/best/worst fitness, etc) to file</span>
<span class="linenos"> 635</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 636</span>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/bestlivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">liveFile</span><span class="p">:</span>
<span class="linenos"> 637</span>                <span class="n">avg</span> <span class="o">=</span> <span class="n">fitness_sum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_population_size</span><span class="p">()</span>
<span class="linenos"> 638</span>                <span class="c1"># Format: Epoch, Best Fitness, Worst Fitness, Average Fitness, Ovr Best Fitness, Diversity Measure</span>
<span class="linenos"> 639</span>                <span class="n">liveFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 640</span>                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">()),</span>
<span class="linenos"> 641</span>                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()),</span>
<span class="linenos"> 642</span>                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()),</span>
<span class="linenos"> 643</span>                    <span class="nb">str</span><span class="p">(</span><span class="n">avg</span><span class="p">),</span>
<span class="linenos"> 644</span>                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_overall_best_circuit_info</span><span class="p">()</span><span class="o">.</span><span class="n">fitness</span><span class="p">),</span>
<span class="linenos"> 645</span>                    <span class="n">diversity</span>
<span class="linenos"> 646</span>                <span class="p">))</span>
<span class="linenos"> 647</span>        
<span class="linenos"> 648</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__multiple_populations</span><span class="p">:</span>
<span class="linenos"> 649</span>            <span class="c1"># Write the population counts to file (i.e. count of circuits from each source population)</span>
<span class="linenos"> 650</span>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/poplivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live_file</span><span class="p">:</span>
<span class="linenos"> 651</span>                <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__num_subpops</span>
<span class="linenos"> 652</span>                <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 653</span>                    <span class="n">population</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_file_attribute</span><span class="p">(</span><span class="s1">&#39;src_population&#39;</span><span class="p">))</span>
<span class="linenos"> 654</span>                    <span class="n">counts</span><span class="p">[</span><span class="n">population</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">population</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos"> 655</span>                <span class="n">live_file</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__num_subpops</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">counts</span><span class="p">))</span>
<span class="linenos"> 656</span>
<span class="linenos"> 657</span>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<span class="linenos"> 658</span>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/violinlivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live_file</span><span class="p">:</span>
<span class="linenos"> 659</span>                <span class="n">fits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 660</span>                <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 661</span>                    <span class="n">fits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()))</span>
<span class="linenos"> 662</span>                <span class="n">live_file</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fits</span><span class="p">)))</span>
<span class="linenos"> 663</span>            
<span class="linenos"> 664</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FULLY_INTRINSIC&quot;</span><span class="p">:</span>
<span class="linenos"> 665</span>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">is_pulse_func</span><span class="p">():</span>
<span class="linenos"> 666</span>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/heatmaplivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live_file2</span><span class="p">:</span>
<span class="linenos"> 667</span>                        <span class="n">best</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 668</span>                        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TONE_DISCRIMINATOR&quot;</span><span class="p">):</span>
<span class="linenos"> 669</span>                            <span class="c1"># Need a slightly different function for tone discriminator waveform</span>
<span class="linenos"> 670</span>                            <span class="n">data</span>  <span class="o">=</span> <span class="n">best</span><span class="o">.</span><span class="n">get_waveform_td</span><span class="p">()</span>
<span class="linenos"> 671</span>                        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 672</span>                            <span class="n">data</span> <span class="o">=</span> <span class="n">best</span><span class="o">.</span><span class="n">get_waveform</span><span class="p">()</span>
<span class="linenos"> 673</span>                        <span class="n">live_file2</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
<span class="linenos"> 674</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 675</span>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/pulselivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live_file3</span><span class="p">:</span>
<span class="linenos"> 676</span>                        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>    
<span class="linenos"> 677</span>                        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 678</span>                            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_extra_data</span><span class="p">(</span><span class="s1">&#39;pulses&#39;</span><span class="p">)))</span>
<span class="linenos"> 679</span>                        <span class="n">live_file3</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
<span class="linenos"> 680</span>
<span class="linenos"> 681</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">saving_population_bistream</span><span class="p">():</span>
<span class="linenos"> 682</span>                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span> <span class="o">%</span>
<span class="linenos"> 683</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_population_bistream_save_interval</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<span class="linenos"> 684</span>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/bitstream_avg.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live_file4</span><span class="p">:</span>
<span class="linenos"> 685</span>                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_differing_bits_str</span><span class="p">()</span>
<span class="linenos"> 686</span>                        <span class="n">live_file4</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
<span class="linenos"> 687</span>
<span class="linenos"> 688</span>            <span class="c1"># TODO: Re-enable this. Temporarily disabled in case files get too large</span>
<span class="linenos"> 689</span>            <span class="c1">#self.__save_generation()</span>
<span class="linenos"> 690</span>
<span class="linenos"> 691</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__save_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 692</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 693</span><span class="sd">        Saves the current generation to the generations directory</span>
<span class="linenos"> 694</span><span class="sd">        Each generation gets its own file</span>
<span class="linenos"> 695</span>
<span class="linenos"> 696</span><span class="sd">        Saves all modifiable parts of a generation so it can be reconstructed.</span>
<span class="linenos"> 697</span>
<span class="linenos"> 698</span><span class="sd">        called by __write_to_livedata(self)</span>
<span class="linenos"> 699</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 700</span>        <span class="n">gen_lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 701</span>        <span class="c1"># At the top, add the necessary config params such as routing and accessed columns</span>
<span class="linenos"> 702</span>        <span class="n">gen_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_routing_type</span><span class="p">())</span>
<span class="linenos"> 703</span>        <span class="n">gen_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_accessed_columns</span><span class="p">()))</span>
<span class="linenos"> 704</span>        <span class="c1"># Now, add the bitstream for each circuit on its own line</span>
<span class="linenos"> 705</span>        <span class="c1"># We want the circuits in number order though</span>
<span class="linenos"> 706</span>        <span class="n">sorted_by_index</span> <span class="o">=</span> <span class="n">SortedKeyList</span><span class="p">(</span>
<span class="linenos"> 707</span>            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ckt</span><span class="p">:</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_index</span><span class="p">()</span>
<span class="linenos"> 708</span>        <span class="p">)</span>
<span class="linenos"> 709</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 710</span>            <span class="n">sorted_by_index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 711</span>        <span class="c1"># Now add each circuit</span>
<span class="linenos"> 712</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="n">sorted_by_index</span><span class="p">:</span>
<span class="linenos"> 713</span>            <span class="n">bitstream</span> <span class="o">=</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_intrinsic_modifiable_bitstream</span><span class="p">()</span>
<span class="linenos"> 714</span>            <span class="n">bitstring</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bitstream</span><span class="p">)</span>
<span class="linenos"> 715</span>            <span class="n">gen_lines</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bitstring</span><span class="p">)</span>
<span class="linenos"> 716</span>        <span class="c1"># Now actually write the file</span>
<span class="linenos"> 717</span>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_generations_directory</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;gen&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">)</span>
<span class="linenos"> 718</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos"> 719</span>            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">gen_lines</span><span class="p">)</span>
<span class="linenos"> 720</span>
<span class="linenos"> 721</span>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<span class="linenos"> 722</span>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/heatmaplivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live_file</span><span class="p">:</span>
<span class="linenos"> 723</span>                <span class="n">best</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 724</span>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_fitness_func</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TONE_DISCRIMINATOR&quot;</span><span class="p">):</span>
<span class="linenos"> 725</span>                    <span class="c1"># Need a slightly different function for tone discriminator waveform</span>
<span class="linenos"> 726</span>                    <span class="n">live_file</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">best</span><span class="o">.</span><span class="n">get_waveform_td</span><span class="p">())))</span>
<span class="linenos"> 727</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 728</span>                    <span class="n">live_file</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">best</span><span class="o">.</span><span class="n">get_waveform</span><span class="p">())))</span>
<span class="linenos"> 729</span>
<span class="linenos"> 730</span>    <span class="c1"># SECTION Selection algorithms.</span>
<span class="linenos"> 731</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__run_classic_tournament</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 732</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 733</span><span class="sd">        Selection Algorithm that randomly pairs together circuits, compares their fitness, and preforms crossover on and mutates the &quot;loser&quot;</span>
<span class="linenos"> 734</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 735</span>        <span class="n">population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos"> 736</span>
<span class="linenos"> 737</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Tournament Number:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">())</span>
<span class="linenos"> 738</span>
<span class="linenos"> 739</span>        <span class="c1"># For all Circuits in the CircuitPopulation, take two random</span>
<span class="linenos"> 740</span>        <span class="c1"># circuits at a time from the population and compare them. Copy</span>
<span class="linenos"> 741</span>        <span class="c1"># some genes from the fittest of the two to the least fittest of</span>
<span class="linenos"> 742</span>        <span class="c1"># the two and mutate the latter.</span>
<span class="linenos"> 743</span>        <span class="k">for</span> <span class="n">ckt1</span><span class="p">,</span> <span class="n">ckt2</span> <span class="ow">in</span> <span class="n">CircuitPopulation</span><span class="o">.</span><span class="n">__group</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<span class="linenos"> 744</span>            <span class="n">winner</span> <span class="o">=</span> <span class="n">ckt1</span>
<span class="linenos"> 745</span>            <span class="n">loser</span> <span class="o">=</span> <span class="n">ckt2</span>
<span class="linenos"> 746</span>            <span class="k">if</span> <span class="n">ckt2</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">ckt1</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">():</span>
<span class="linenos"> 747</span>                <span class="n">winner</span> <span class="o">=</span> <span class="n">ckt2</span>
<span class="linenos"> 748</span>                <span class="n">loser</span> <span class="o">=</span> <span class="n">ckt1</span>
<span class="linenos"> 749</span>
<span class="linenos"> 750</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>
<span class="linenos"> 751</span>                            <span class="s2">&quot;Fitness </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2"> &lt; Fitness </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 752</span>                                <span class="n">loser</span><span class="p">,</span>
<span class="linenos"> 753</span>                                <span class="n">loser</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">(),</span>
<span class="linenos"> 754</span>                                <span class="n">winner</span><span class="p">,</span>
<span class="linenos"> 755</span>                                <span class="n">winner</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 756</span>                            <span class="p">))</span>
<span class="linenos"> 757</span>
<span class="linenos"> 758</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_crossover_probability</span><span class="p">():</span>
<span class="linenos"> 759</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__single_point_crossover</span><span class="p">(</span><span class="n">winner</span><span class="p">,</span> <span class="n">loser</span><span class="p">)</span>
<span class="linenos"> 760</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 761</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Cloning:&quot;</span><span class="p">,</span> <span class="n">winner</span><span class="p">,</span> <span class="s2">&quot; ---&gt; &quot;</span><span class="p">,</span> <span class="n">loser</span><span class="p">)</span>
<span class="linenos"> 762</span>                <span class="n">loser</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">winner</span><span class="p">)</span>
<span class="linenos"> 763</span>
<span class="linenos"> 764</span>            <span class="n">loser</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 765</span>
<span class="linenos"> 766</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__run_single_elite_tournament</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 767</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 768</span><span class="sd">        Selection Algorithm that mutates the hardware of every circuit that is not the current best circuit</span>
<span class="linenos"> 769</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 770</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Tournament Number: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 771</span>            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">())))</span>
<span class="linenos"> 772</span>
<span class="linenos"> 773</span>        <span class="n">best</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 774</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__protected_elites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
<span class="linenos"> 775</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 776</span>            <span class="c1"># Mutate the hardware of every circuit that is not the best</span>
<span class="linenos"> 777</span>            <span class="k">if</span> <span class="n">ckt</span> <span class="o">!=</span> <span class="n">best</span><span class="p">:</span>
<span class="linenos"> 778</span>                <span class="k">if</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">best</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">():</span>
<span class="linenos"> 779</span>                    <span class="n">ckt</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 780</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 781</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ckt</span><span class="p">,</span> <span class="s2">&quot;is current BEST&quot;</span><span class="p">)</span>
<span class="linenos"> 782</span>
<span class="linenos"> 783</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__run_fitness_proportional_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 784</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 785</span><span class="sd">        Selection algorithm that compares every circuit in the population to a random elite (chosen proportionally based on each elite&#39;s fitness).</span>
<span class="linenos"> 786</span><span class="sd">        If circuit has a lower fitness, crossover or mutate the circuit</span>
<span class="linenos"> 787</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 788</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of Elites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">)</span>
<span class="linenos"> 789</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Ranked Fitness:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos"> 790</span>
<span class="linenos"> 791</span>        <span class="c1"># Generate a group of elites from the best n = &lt;self.__n_elites&gt;</span>
<span class="linenos"> 792</span>        <span class="c1"># Circuits. Based on their fitness values, map each Circuit with</span>
<span class="linenos"> 793</span>        <span class="c1"># a probabilty value (used later for crossover/copying/mutation).</span>
<span class="linenos"> 794</span>        <span class="n">elites</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 795</span>        <span class="n">elite_sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 796</span>
<span class="linenos"> 797</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">):</span>
<span class="linenos"> 798</span>            <span class="n">elites</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 799</span>            <span class="n">elite_sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span>
<span class="linenos"> 800</span>        <span class="k">if</span> <span class="n">elite_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 801</span>            <span class="k">for</span> <span class="n">elite</span> <span class="ow">in</span> <span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="linenos"> 802</span>                <span class="n">elites</span><span class="p">[</span><span class="n">elite</span><span class="p">]</span> <span class="o">=</span> <span class="n">elite</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">/</span> <span class="n">elite_sum</span>
<span class="linenos"> 803</span>        <span class="k">elif</span> <span class="n">elite_sum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 804</span>            <span class="k">for</span> <span class="n">elite</span> <span class="ow">in</span> <span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="linenos"> 805</span>                <span class="n">elites</span><span class="p">[</span><span class="n">elite</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span>
<span class="linenos"> 806</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 807</span>            <span class="c1"># elite_sum is negative. This should not be possible.</span>
<span class="linenos"> 808</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_error</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Elite_sum is negative. Exiting...&quot;</span><span class="p">)</span>
<span class="linenos"> 809</span>            <span class="n">exit</span><span class="p">()</span>
<span class="linenos"> 810</span>
<span class="linenos"> 811</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Elite Group:&quot;</span><span class="p">,</span> <span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="linenos"> 812</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Elite Probabilites:&quot;</span><span class="p">,</span> <span class="n">elites</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="linenos"> 813</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__protected_elites</span> <span class="o">=</span> <span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="linenos"> 814</span>
<span class="linenos"> 815</span>        <span class="c1"># For all Circuits in this CircuitPopulation, choose a random</span>
<span class="linenos"> 816</span>        <span class="c1"># elite (based on the associated probabilities calculated above)</span>
<span class="linenos"> 817</span>        <span class="c1"># and compare it to the Circuit. If the Circuit has lower</span>
<span class="linenos"> 818</span>        <span class="c1"># fitness than the elite, perform crossover (with the elite) and</span>
<span class="linenos"> 819</span>        <span class="c1"># mutation on it (or copy the elite&#39;s hardware if crossover is</span>
<span class="linenos"> 820</span>        <span class="c1"># disabled).</span>
<span class="linenos"> 821</span>        <span class="n">elite_prob_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="linenos"> 822</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 823</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 824</span>                <span class="k">if</span> <span class="n">elite_prob_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 825</span>                    <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<span class="linenos"> 826</span>                        <span class="nb">list</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<span class="linenos"> 827</span>                        <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">,</span>
<span class="linenos"> 828</span>                        <span class="n">p</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="linenos"> 829</span>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 830</span>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># If fitness isn&#39;t negative, this should never happen</span>
<span class="linenos"> 831</span>                    <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 832</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 833</span>                <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos"> 834</span>
<span class="linenos"> 835</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Elite&quot;</span><span class="p">,</span> <span class="n">rand_elite</span><span class="p">)</span>
<span class="linenos"> 836</span>
<span class="linenos"> 837</span>            <span class="k">if</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rand_elite</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ckt</span> <span class="o">!=</span> <span class="n">rand_elite</span> <span class="ow">and</span> <span class="n">ckt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elites</span><span class="p">:</span>
<span class="linenos"> 838</span>                <span class="c1"># if self.__config.get_crossover_probability() == 0:</span>
<span class="linenos"> 839</span>                <span class="c1"># 	self.__log_event(3, &quot;Cloning:&quot;, rand_elite, &quot; ---&gt; &quot;, ckt)</span>
<span class="linenos"> 840</span>                <span class="c1"># 	ckt.copy_from(rand_elite)</span>
<span class="linenos"> 841</span>                <span class="c1"># else:</span>
<span class="linenos"> 842</span>                <span class="c1"># 	self.__single_point_crossover(rand_elite, ckt)</span>
<span class="linenos"> 843</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_crossover_probability</span><span class="p">():</span>
<span class="linenos"> 844</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__single_point_crossover</span><span class="p">(</span><span class="n">rand_elite</span><span class="p">,</span> <span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 845</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 846</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Cloning:&quot;</span><span class="p">,</span> <span class="n">rand_elite</span><span class="p">,</span> <span class="s2">&quot; ---&gt; &quot;</span><span class="p">,</span> <span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 847</span>                    <span class="n">ckt</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">rand_elite</span><span class="p">)</span>
<span class="linenos"> 848</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 849</span>
<span class="linenos"> 850</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__run_rank_proportional_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 851</span><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="linenos"> 852</span><span class="sd">        Selection algorithm that compares every circuit in the population to a random elite (chosen proportionally based on each elite&#39;s rank).</span>
<span class="linenos"> 853</span><span class="sd">        If circuit has a lower fitness, crossover or mutate the circuit</span>
<span class="linenos"> 854</span><span class="sd">        &#39;&#39;&#39;</span>
<span class="linenos"> 855</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of Elites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">)</span>
<span class="linenos"> 856</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Ranked Fitness:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos"> 857</span>
<span class="linenos"> 858</span>        <span class="c1"># Generate a group of elites from the best n = &lt;self.__n_elites&gt;</span>
<span class="linenos"> 859</span>        <span class="c1"># Circuits. Based on their fitness values, map each Circuit with</span>
<span class="linenos"> 860</span>        <span class="c1"># a probabilty value (used later for crossover/copying/mutation).</span>
<span class="linenos"> 861</span>        <span class="n">elites</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 862</span>        <span class="c1"># can use summation formula since sum of ranks is the sum of natural numbers</span>
<span class="linenos"> 863</span>        <span class="n">elite_sum</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="linenos"> 864</span>        <span class="k">if</span> <span class="p">(</span><span class="n">elite_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<span class="linenos"> 865</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">):</span>
<span class="linenos"> 866</span>                <span class="c1"># Using (self.__n_elites - i) since highest ranked indiviual is at self.__circuits[0]</span>
<span class="linenos"> 867</span>                <span class="n">elites</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">elite_sum</span>
<span class="linenos"> 868</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 869</span>            <span class="c1"># elite_sum is negative. This should not be possible.</span>
<span class="linenos"> 870</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_error</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Elite_sum is zero or negative. Exiting...&quot;</span><span class="p">)</span>
<span class="linenos"> 871</span>            <span class="n">exit</span><span class="p">()</span>
<span class="linenos"> 872</span>
<span class="linenos"> 873</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Elite Group:&quot;</span><span class="p">,</span> <span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="linenos"> 874</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Elite Probabilites:&quot;</span><span class="p">,</span> <span class="n">elites</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="linenos"> 875</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__protected_elites</span> <span class="o">=</span> <span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="linenos"> 876</span>        <span class="c1">#self.__log_event(3, &quot;Elite&quot;, rand_elite)</span>
<span class="linenos"> 877</span>
<span class="linenos"> 878</span>        <span class="c1"># For all Circuits in this CircuitPopulation, choose a random</span>
<span class="linenos"> 879</span>        <span class="c1"># elite (based on the associated probabilities calculated above)</span>
<span class="linenos"> 880</span>        <span class="c1"># and compare it to the Circuit. If the Circuit has lower</span>
<span class="linenos"> 881</span>        <span class="c1"># fitness than the elite, perform crossover (with the elite) and</span>
<span class="linenos"> 882</span>        <span class="c1"># mutation on it (or copy the elite&#39;s hardware if crossover is</span>
<span class="linenos"> 883</span>        <span class="c1"># disabled).</span>
<span class="linenos"> 884</span>        <span class="n">elite_prob_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="linenos"> 885</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 886</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 887</span>                <span class="k">if</span> <span class="n">elite_prob_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 888</span>                    <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<span class="linenos"> 889</span>                        <span class="nb">list</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<span class="linenos"> 890</span>                        <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">,</span>
<span class="linenos"> 891</span>                        <span class="n">p</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="linenos"> 892</span>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 893</span>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># If fitness isn&#39;t negative, this should never happen</span>
<span class="linenos"> 894</span>                    <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 895</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 896</span>                <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos"> 897</span>
<span class="linenos"> 898</span>            <span class="k">if</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rand_elite</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ckt</span> <span class="o">!=</span> <span class="n">rand_elite</span> <span class="ow">and</span> <span class="n">ckt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elites</span><span class="p">:</span>
<span class="linenos"> 899</span>                <span class="c1"># if self.__config.get_crossover_probability() == 0:</span>
<span class="linenos"> 900</span>                <span class="c1">#     self.__log_event(3, &quot;Cloning:&quot;, rand_elite, &quot; ---&gt; &quot;, ckt)</span>
<span class="linenos"> 901</span>                <span class="c1">#     ckt.copy_from(rand_elite)</span>
<span class="linenos"> 902</span>                <span class="c1"># else:</span>
<span class="linenos"> 903</span>                <span class="c1">#     self.__single_point_crossover(rand_elite, ckt)</span>
<span class="linenos"> 904</span>
<span class="linenos"> 905</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_crossover_probability</span><span class="p">():</span>
<span class="linenos"> 906</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__single_point_crossover</span><span class="p">(</span><span class="n">rand_elite</span><span class="p">,</span> <span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 907</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 908</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Cloning:&quot;</span><span class="p">,</span> <span class="n">rand_elite</span><span class="p">,</span> <span class="s2">&quot; ---&gt; &quot;</span><span class="p">,</span> <span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 909</span>                    <span class="n">ckt</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">rand_elite</span><span class="p">)</span>
<span class="linenos"> 910</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 911</span>
<span class="linenos"> 912</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__run_fractional_elite_tournament</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 913</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 914</span><span class="sd">        Selection algorithm that compares every circuit in the population to a random elite. If circuit has a lower fitness, crossover or mutate the circuit</span>
<span class="linenos"> 915</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 916</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of Elites: &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">))</span>
<span class="linenos"> 917</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Ranked Fitness: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos"> 918</span>
<span class="linenos"> 919</span>        <span class="c1"># Generate a group of elite Circuits from the</span>
<span class="linenos"> 920</span>        <span class="c1"># n = &lt;self.__n_elites&gt; best performing Circuits.</span>
<span class="linenos"> 921</span>        <span class="n">elite_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 922</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__n_elites</span><span class="p">):</span>
<span class="linenos"> 923</span>            <span class="n">elite_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="linenos"> 924</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_info</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Elite Group:&quot;</span><span class="p">,</span> <span class="n">elite_group</span><span class="p">)</span>
<span class="linenos"> 925</span>
<span class="linenos"> 926</span>        <span class="c1"># For all the Circuits in the CircuitPopulation compare the</span>
<span class="linenos"> 927</span>        <span class="c1"># Circuit against a random elite Circuit from the group</span>
<span class="linenos"> 928</span>        <span class="c1"># generated above. If the Circuit&#39;s fitness is less than than</span>
<span class="linenos"> 929</span>        <span class="c1"># the elite&#39;s perform crossover (or clone if crossover is</span>
<span class="linenos"> 930</span>        <span class="c1"># disabled) and then mutate the Circuit.</span>
<span class="linenos"> 931</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__protected_elites</span> <span class="o">=</span> <span class="n">elite_group</span>
<span class="linenos"> 932</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 933</span>            <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">elite_group</span><span class="p">)</span>
<span class="linenos"> 934</span>            <span class="k">if</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rand_elite</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ckt</span> <span class="o">!=</span> <span class="n">rand_elite</span> <span class="ow">and</span> <span class="n">ckt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elite_group</span><span class="p">:</span>
<span class="linenos"> 935</span>                <span class="c1"># if self.__config.crossover_probability  == 0:</span>
<span class="linenos"> 936</span>                <span class="c1">#     self.__log_event(3, &quot;Cloning:&quot;, rand_elite, &quot; ---&gt; &quot;, ckt)</span>
<span class="linenos"> 937</span>                <span class="c1">#     ckt.replace_hardware_file(rand_elite.get_hardware_filepath)</span>
<span class="linenos"> 938</span>                <span class="c1"># else:</span>
<span class="linenos"> 939</span>                <span class="c1">#     self.__single_point_crossover(rand_elite, ckt)</span>
<span class="linenos"> 940</span>
<span class="linenos"> 941</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_crossover_probability</span><span class="p">():</span>
<span class="linenos"> 942</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__single_point_crossover</span><span class="p">(</span><span class="n">rand_elite</span><span class="p">,</span> <span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 943</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 944</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Cloning:&quot;</span><span class="p">,</span> <span class="n">rand_elite</span><span class="p">,</span> <span class="s2">&quot; ---&gt; &quot;</span><span class="p">,</span> <span class="n">ckt</span><span class="p">)</span>
<span class="linenos"> 945</span>                    <span class="n">ckt</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">rand_elite</span><span class="p">)</span>
<span class="linenos"> 946</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 947</span>
<span class="linenos"> 948</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__run_map_elites_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 949</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 950</span><span class="sd">        Selection Algorithm that is an alternate version of the map elites algorithm from another paper.</span>
<span class="linenos"> 951</span><span class="sd">        This version of map elites will protect the highest-fitness individual in each &quot;square&quot;</span>
<span class="linenos"> 952</span><span class="sd">        We&#39;re going to have slightly granular squares to make sure that circuits have room to spread out early</span>
<span class="linenos"> 953</span><span class="sd">        to hopefully promote diversity</span>
<span class="linenos"> 954</span><span class="sd">        Group size length of 50 means we&#39;ll have 21x21 groups</span>
<span class="linenos"> 955</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 956</span>
<span class="linenos"> 957</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_map_elites_dimension</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 958</span>            <span class="n">elite_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__generate_pulse_map</span><span class="p">()</span>
<span class="linenos"> 959</span>            <span class="n">elites</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">elite_map</span><span class="p">]))</span>
<span class="linenos"> 960</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 961</span>            <span class="n">elite_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__generate_map</span><span class="p">()</span>
<span class="linenos"> 962</span>            <span class="n">elites</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">elite_map</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sub</span><span class="p">]))</span>
<span class="linenos"> 963</span>
<span class="linenos"> 964</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__protected_elites</span> <span class="o">=</span> <span class="n">elites</span>
<span class="linenos"> 965</span>
<span class="linenos"> 966</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos"> 967</span>            <span class="c1"># If not an elite, then we will clone and mutate</span>
<span class="linenos"> 968</span>            <span class="k">if</span> <span class="n">ckt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elites</span><span class="p">:</span>
<span class="linenos"> 969</span>                <span class="n">rand_elite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">elites</span><span class="p">)</span>
<span class="linenos"> 970</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">rand_elite</span><span class="p">)</span>
<span class="linenos"> 971</span>                <span class="n">ckt</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="linenos"> 972</span>        
<span class="linenos"> 973</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__output_map_file</span><span class="p">(</span><span class="n">elite_map</span><span class="p">)</span>
<span class="linenos"> 974</span>
<span class="linenos"> 975</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__output_map_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elite_map</span><span class="p">):</span>
<span class="linenos"> 976</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 977</span><span class="sd">        Writes the map to a file (workspace/maplivedata.log)</span>
<span class="linenos"> 978</span>
<span class="linenos"> 979</span><span class="sd">        Parameters</span>
<span class="linenos"> 980</span><span class="sd">        ----------</span>
<span class="linenos"> 981</span><span class="sd">        elite_map : Circuit[][]</span>
<span class="linenos"> 982</span><span class="sd">            2D array of circuits that fell into these groupings depending on their characteristics.</span>
<span class="linenos"> 983</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 984</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;workspace/maplivedata.log&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">liveFile</span><span class="p">:</span>
<span class="linenos"> 985</span>            <span class="c1"># First line describes granularity/scale factor</span>
<span class="linenos"> 986</span>            <span class="n">liveFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ELITE_MAP_SCALE_FACTOR</span><span class="p">)))</span>
<span class="linenos"> 987</span>            <span class="c1"># If square is empty, write a &quot;blank&quot; to that line</span>
<span class="linenos"> 988</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_map_elites_dimension</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 989</span>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elite_map</span><span class="p">)):</span>
<span class="linenos"> 990</span>                    <span class="n">ckt</span> <span class="o">=</span> <span class="n">elite_map</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
<span class="linenos"> 991</span>                    <span class="k">if</span> <span class="n">ckt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 992</span>                        <span class="n">liveFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()))</span>
<span class="linenos"> 993</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 994</span>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elite_map</span><span class="p">)):</span>
<span class="linenos"> 995</span>                    <span class="n">sl</span> <span class="o">=</span> <span class="n">elite_map</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
<span class="linenos"> 996</span>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sl</span><span class="p">)):</span>
<span class="linenos"> 997</span>                        <span class="n">ckt</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
<span class="linenos"> 998</span>                        <span class="n">to_write</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="linenos"> 999</span>                        <span class="k">if</span> <span class="n">ckt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1000</span>                            <span class="n">to_write</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">())</span>
<span class="linenos">1001</span>                        <span class="n">liveFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">to_write</span><span class="p">))</span>
<span class="linenos">1002</span>
<span class="linenos">1003</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__generate_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1004</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1005</span><span class="sd">        Generates the elite map for this generation based on variance.</span>
<span class="linenos">1006</span><span class="sd">        </span>
<span class="linenos">1007</span><span class="sd">        Returns</span>
<span class="linenos">1008</span><span class="sd">        -------</span>
<span class="linenos">1009</span><span class="sd">        list(list(Circuit))</span>
<span class="linenos">1010</span><span class="sd">            A 2D array of circuits catagorized based off of shared characteristics</span>
<span class="linenos">1011</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1012</span>        <span class="c1"># If the value is not a circuit (i.e. it is 0) then we know the spot is open to be filled in</span>
<span class="linenos">1013</span>        <span class="c1"># Go up to 21 since upper bound is 1024</span>
<span class="linenos">1014</span>        <span class="c1"># Can&#39;t do [[0]*21]*21 because this will make all the sub-arrays point to same memory location</span>
<span class="linenos">1015</span>        <span class="n">elite_map</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1016</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">22</span><span class="p">):</span>
<span class="linenos">1017</span>            <span class="n">elite_map</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">21</span><span class="p">)</span>
<span class="linenos">1018</span>        <span class="c1"># Evaluate each circuit&#39;s fitness and where it falls on the elite map</span>
<span class="linenos">1019</span>        <span class="c1"># Populate elite map first</span>
<span class="linenos">1020</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos">1021</span>            <span class="n">row</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_low_value</span><span class="p">()</span> <span class="o">/</span> <span class="n">ELITE_MAP_SCALE_FACTOR</span><span class="p">)</span>
<span class="linenos">1022</span>            <span class="n">col</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_high_value</span><span class="p">()</span> <span class="o">/</span> <span class="n">ELITE_MAP_SCALE_FACTOR</span><span class="p">)</span>
<span class="linenos">1023</span>            <span class="k">if</span> <span class="n">elite_map</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">elite_map</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">():</span>
<span class="linenos">1024</span>                <span class="n">elite_map</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ckt</span>
<span class="linenos">1025</span>        <span class="k">return</span> <span class="n">elite_map</span>
<span class="linenos">1026</span>   
<span class="linenos">1027</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__generate_pulse_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1028</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1029</span><span class="sd">        Generates the elite map for this generation based on pulse count.</span>
<span class="linenos">1030</span>
<span class="linenos">1031</span><span class="sd">        Returns</span>
<span class="linenos">1032</span><span class="sd">        -------</span>
<span class="linenos">1033</span><span class="sd">        Circuit[][]</span>
<span class="linenos">1034</span><span class="sd">            A 2D array of circuits catagorized based off of shared characteristics</span>
<span class="linenos">1035</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1036</span>
<span class="linenos">1037</span>        <span class="n">elite_map</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1038</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="mi">150_000</span> <span class="o">-</span> <span class="mi">1_000</span><span class="p">)</span> <span class="o">/</span> <span class="n">PULSE_ELITE_MAP_SCALE_FACTOR</span><span class="p">):</span>
<span class="linenos">1039</span>            <span class="n">elite_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">1040</span>        <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos">1041</span>            <span class="n">col</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_mean_frequency</span><span class="p">()</span> <span class="o">/</span> <span class="n">PULSE_ELITE_MAP_SCALE_FACTOR</span><span class="p">)</span>
<span class="linenos">1042</span>            <span class="k">if</span> <span class="n">elite_map</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ckt</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">elite_map</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">get_fitness</span><span class="p">():</span>
<span class="linenos">1043</span>                <span class="n">elite_map</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ckt</span>
<span class="linenos">1044</span>        <span class="k">return</span> <span class="n">elite_map</span>
<span class="linenos">1045</span>
<span class="linenos">1046</span>    <span class="c1"># SECTION Getters.</span>
<div class="viewcode-block" id="CircuitPopulation.get_current_best_circuit">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.get_current_best_circuit">[docs]</a>
<span class="linenos">1047</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_best_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1048</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1049</span><span class="sd">        Gets the circuit in the current generation with the highest fitness</span>
<span class="linenos">1050</span>
<span class="linenos">1051</span><span class="sd">        Returns</span>
<span class="linenos">1052</span><span class="sd">        -------</span>
<span class="linenos">1053</span><span class="sd">        Circuit</span>
<span class="linenos">1054</span><span class="sd">            Returns the best circuit in population.</span>
<span class="linenos">1055</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1056</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<span class="linenos">1057</span>
<div class="viewcode-block" id="CircuitPopulation.get_overall_best_circuit_info">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.get_overall_best_circuit_info">[docs]</a>
<span class="linenos">1058</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_overall_best_circuit_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1059</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1060</span><span class="sd">        Returns the information of the circuit with the highest fitness throughout the run </span>
<span class="linenos">1061</span>
<span class="linenos">1062</span><span class="sd">        Returns</span>
<span class="linenos">1063</span><span class="sd">        -------</span>
<span class="linenos">1064</span><span class="sd">        CircuitInfo</span>
<span class="linenos">1065</span><span class="sd">            Returns the info object for the overall best circuit throughout the run.</span>
<span class="linenos">1066</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1067</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__overall_best_circuit_info</span></div>

<span class="linenos">1068</span>
<div class="viewcode-block" id="CircuitPopulation.get_current_epoch">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.get_current_epoch">[docs]</a>
<span class="linenos">1069</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1070</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1071</span><span class="sd">        Returns the generation number</span>
<span class="linenos">1072</span>
<span class="linenos">1073</span><span class="sd">        Returns</span>
<span class="linenos">1074</span><span class="sd">        -------</span>
<span class="linenos">1075</span><span class="sd">        int</span>
<span class="linenos">1076</span><span class="sd">            Returns the generation number of the current evolution.</span>
<span class="linenos">1077</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1078</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_epoch</span></div>

<span class="linenos">1079</span>
<div class="viewcode-block" id="CircuitPopulation.get_best_epoch">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.get_best_epoch">[docs]</a>
<span class="linenos">1080</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_best_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1081</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1082</span><span class="sd">        Returns the generation number that contained the circuit with the highest fitness</span>
<span class="linenos">1083</span>
<span class="linenos">1084</span><span class="sd">        Returns</span>
<span class="linenos">1085</span><span class="sd">        -------</span>
<span class="linenos">1086</span><span class="sd">        int</span>
<span class="linenos">1087</span><span class="sd">            Generation number that hat the circuit with the highest fitness</span>
<span class="linenos">1088</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1089</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__best_epoch</span></div>

<span class="linenos">1090</span>
<span class="linenos">1091</span>    <span class="c1"># SECTION Miscellaneous helper functions.</span>
<span class="linenos">1092</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__single_point_crossover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
<span class="linenos">1093</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1094</span><span class="sd">        Copy some series of chiasmas (points of genetic exchange) from fitter circuit into children</span>
<span class="linenos">1095</span>
<span class="linenos">1096</span><span class="sd">        Parameters</span>
<span class="linenos">1097</span><span class="sd">        ----------</span>
<span class="linenos">1098</span><span class="sd">        source : Circuit</span>
<span class="linenos">1099</span><span class="sd">            The circuit you are copying data from.</span>
<span class="linenos">1100</span><span class="sd">        dest : Circuit</span>
<span class="linenos">1101</span><span class="sd">            The circuit you are overwriting data from source to.</span>
<span class="linenos">1102</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1103</span>        <span class="n">crossover_point</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1104</span>
<span class="linenos">1105</span>        <span class="c1"># Replace magic values with more generalized solutions</span>
<span class="linenos">1106</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FULLY_SIM&quot;</span><span class="p">:</span>
<span class="linenos">1107</span>            <span class="n">crossover_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span>
<span class="linenos">1108</span>                <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_bitstream</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos">1109</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_routing_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;MOORE&quot;</span><span class="p">:</span>
<span class="linenos">1110</span>            <span class="n">crossover_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="linenos">1111</span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_routing_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;NWSE&quot;</span><span class="p">:</span>
<span class="linenos">1112</span>            <span class="n">crossover_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rand</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="linenos">1113</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">1114</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_error</span><span class="p">(</span>
<span class="linenos">1115</span>                <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Invalid routing type specified in config.ini. Exiting...&quot;</span><span class="p">)</span>
<span class="linenos">1116</span>            <span class="n">exit</span><span class="p">()</span>
<span class="linenos">1117</span>        <span class="n">dest</span><span class="o">.</span><span class="n">crossover</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">crossover_point</span><span class="p">)</span>
<span class="linenos">1118</span>
<div class="viewcode-block" id="CircuitPopulation.avg_hamming_dist">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.avg_hamming_dist">[docs]</a>
<span class="linenos">1119</span>    <span class="k">def</span><span class="w"> </span><span class="nf">avg_hamming_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1120</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1121</span><span class="sd">        Calculates and returns the average Hamming distance for the population</span>
<span class="linenos">1122</span>
<span class="linenos">1123</span><span class="sd">        Returns</span>
<span class="linenos">1124</span><span class="sd">        -------</span>
<span class="linenos">1125</span><span class="sd">        float</span>
<span class="linenos">1126</span><span class="sd">            Returns Hamming distance in the population.</span>
<span class="linenos">1127</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1128</span>        <span class="n">running_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1129</span>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos">1130</span>        <span class="n">num_pairs</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="linenos">1131</span>
<span class="linenos">1132</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Starting Hamming Distance Calculation&quot;</span><span class="p">)</span>
<span class="linenos">1133</span>        <span class="n">bitstreams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">get_bitstream</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">))</span>
<span class="linenos">1134</span>
<span class="linenos">1135</span>        <span class="c1"># We now have all the bitstreams, we can do the faster hamming calculation by comparing each bit of them</span>
<span class="linenos">1136</span>        <span class="c1"># Then we multiply the count of 1s for that bit by the count of 0s for that bit and add it to the running_total</span>
<span class="linenos">1137</span>        <span class="c1"># Divide that by # of pairs at the end (calculation shown below)</span>
<span class="linenos">1138</span>        <span class="n">running_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1139</span>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">)</span>
<span class="linenos">1140</span>        <span class="n">num_pairs</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="linenos">1141</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;HDIST - Entering loop&quot;</span><span class="p">)</span>
<span class="linenos">1142</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bitstreams</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
<span class="linenos">1143</span>            <span class="n">ones_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1144</span>            <span class="n">zero_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1145</span>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="linenos">1146</span>                <span class="k">if</span> <span class="n">bitstreams</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1147</span>                    <span class="n">zero_count</span> <span class="o">=</span> <span class="n">zero_count</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos">1148</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">1149</span>                    <span class="n">ones_count</span> <span class="o">=</span> <span class="n">ones_count</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos">1150</span>            <span class="n">running_total</span> <span class="o">=</span> <span class="n">running_total</span> <span class="o">+</span> <span class="n">ones_count</span> <span class="o">*</span> <span class="n">zero_count</span>
<span class="linenos">1151</span>
<span class="linenos">1152</span>        <span class="n">running_total</span> <span class="o">=</span> <span class="n">running_total</span> <span class="o">/</span> <span class="n">num_pairs</span>
<span class="linenos">1153</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;HDIST - Final value&quot;</span><span class="p">,</span> <span class="n">running_total</span><span class="p">)</span>
<span class="linenos">1154</span>        <span class="k">return</span> <span class="n">running_total</span></div>

<span class="linenos">1155</span>
<div class="viewcode-block" id="CircuitPopulation.count_unique">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.count_unique">[docs]</a>
<span class="linenos">1156</span>    <span class="k">def</span><span class="w"> </span><span class="nf">count_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1157</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1158</span><span class="sd">        Returns the number of unique files in the population</span>
<span class="linenos">1159</span>
<span class="linenos">1160</span><span class="sd">        Returns</span>
<span class="linenos">1161</span><span class="sd">        -------</span>
<span class="linenos">1162</span><span class="sd">        int</span>
<span class="linenos">1163</span><span class="sd">            Number of unique circuits in the population</span>
<span class="linenos">1164</span><span class="sd">        </span>
<span class="linenos">1165</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1166</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FULLY_SIM&quot;</span><span class="p">:</span>
<span class="linenos">1167</span>            <span class="n">bitstreams</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1168</span>            <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos">1169</span>                <span class="n">bitstreams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_sim_bitstream</span><span class="p">())</span>
<span class="linenos">1170</span>            <span class="n">bitstreams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unique</span><span class="p">(</span><span class="n">bitstreams</span><span class="p">)</span>
<span class="linenos">1171</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span>
<span class="linenos">1172</span>                <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of Unique Individuals:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bitstreams</span><span class="p">))</span>
<span class="linenos">1173</span>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">bitstreams</span><span class="p">)</span>
<span class="linenos">1174</span>
<span class="linenos">1175</span>        <span class="c1"># If not FULLY_SIM, then run this</span>
<span class="linenos">1176</span>        <span class="c1"># TODO: Optimize</span>
<span class="linenos">1177</span>        <span class="n">bin_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_bin_directory</span><span class="p">()</span>
<span class="linenos">1178</span>        <span class="n">dir_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">bin_dir</span><span class="p">)</span>
<span class="linenos">1179</span>        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dir_list</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
<span class="linenos">1180</span>            <span class="nb">str</span><span class="p">(</span><span class="n">bin_dir</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">f</span><span class="p">)]</span>  <span class="c1"># Filter out non-files</span>
<span class="linenos">1181</span>        <span class="n">unique_file_paths</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1182</span>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<span class="linenos">1183</span>            <span class="n">full_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bin_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">file</span>
<span class="linenos">1184</span>            <span class="n">not_unique</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">1185</span>            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">unique_file_paths</span><span class="p">:</span>
<span class="linenos">1186</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__files_eq</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<span class="linenos">1187</span>                    <span class="n">not_unique</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">1188</span>                    <span class="k">break</span>
<span class="linenos">1189</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">not_unique</span><span class="p">:</span>
<span class="linenos">1190</span>                <span class="n">unique_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
<span class="linenos">1191</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of Unique Individuals:&quot;</span><span class="p">,</span>
<span class="linenos">1192</span>                         <span class="nb">len</span><span class="p">(</span><span class="n">unique_file_paths</span><span class="p">))</span>
<span class="linenos">1193</span>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_file_paths</span><span class="p">)</span></div>

<span class="linenos">1194</span>
<span class="linenos">1195</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrays</span><span class="p">):</span>
<span class="linenos">1196</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1197</span><span class="sd">        Returns an array of unique arrays from the input</span>
<span class="linenos">1198</span>
<span class="linenos">1199</span><span class="sd">        Parameters</span>
<span class="linenos">1200</span><span class="sd">        ----------</span>
<span class="linenos">1201</span><span class="sd">        arrays : list[list[T]]</span>
<span class="linenos">1202</span><span class="sd">            An array containing arrays</span>
<span class="linenos">1203</span>
<span class="linenos">1204</span><span class="sd">        Returns</span>
<span class="linenos">1205</span><span class="sd">        -------</span>
<span class="linenos">1206</span><span class="sd">        list[T]</span>
<span class="linenos">1207</span><span class="sd">            Returns a list of all of the unique lists contained in the arrays variable</span>
<span class="linenos">1208</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1209</span>        <span class="n">soln</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1210</span>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
<span class="linenos">1211</span>            <span class="c1"># Check if its in soln; if not, then add it</span>
<span class="linenos">1212</span>            <span class="n">shouldAdd</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">1213</span>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">soln</span><span class="p">:</span>
<span class="linenos">1214</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__arr_eq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="linenos">1215</span>                    <span class="n">shouldAdd</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">1216</span>                    <span class="k">break</span>
<span class="linenos">1217</span>            <span class="k">if</span> <span class="n">shouldAdd</span><span class="p">:</span>
<span class="linenos">1218</span>                <span class="n">soln</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">1219</span>        <span class="k">return</span> <span class="n">soln</span>
<span class="linenos">1220</span>    
<div class="viewcode-block" id="CircuitPopulation.count_differing_bits">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.count_differing_bits">[docs]</a>
<span class="linenos">1221</span>    <span class="k">def</span><span class="w"> </span><span class="nf">count_differing_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1222</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1223</span><span class="sd">        Returns the number of bits in the bistream where 2 circuits have different values</span>
<span class="linenos">1224</span>
<span class="linenos">1225</span><span class="sd">        Returns</span>
<span class="linenos">1226</span><span class="sd">        -------</span>
<span class="linenos">1227</span><span class="sd">        int</span>
<span class="linenos">1228</span><span class="sd">            Number of bits in the bistream where 2 circuits have different values</span>
<span class="linenos">1229</span><span class="sd">        </span>
<span class="linenos">1230</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1231</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">get_simulation_mode</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FULLY_SIM&quot;</span><span class="p">:</span>
<span class="linenos">1232</span>            <span class="n">bitstream_sums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_sim_bitstream</span><span class="p">())]</span>
<span class="linenos">1233</span>            <span class="k">for</span> <span class="n">ckt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">:</span>
<span class="linenos">1234</span>                <span class="n">bitstream_sums</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ckt</span><span class="o">.</span><span class="n">get_sim_bitstream</span><span class="p">())</span>
<span class="linenos">1235</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">1236</span>            <span class="n">bitstream_sums</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__population_bistream_sum</span>
<span class="linenos">1237</span>
<span class="linenos">1238</span>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1239</span>        <span class="k">for</span> <span class="n">bit_sum</span> <span class="ow">in</span> <span class="n">bitstream_sums</span><span class="p">:</span>
<span class="linenos">1240</span>            <span class="k">if</span> <span class="n">bit_sum</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">bit_sum</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__circuits</span><span class="p">):</span>
<span class="linenos">1241</span>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">1242</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__log_event</span><span class="p">(</span>
<span class="linenos">1243</span>                <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of differing bits:&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
<span class="linenos">1244</span>        <span class="k">return</span> <span class="n">count</span></div>

<span class="linenos">1245</span>
<div class="viewcode-block" id="CircuitPopulation.get_differing_bits_str">
<a class="viewcode-back" href="../code/CircuitPopulation.html#CircuitPopulation.CircuitPopulation.get_differing_bits_str">[docs]</a>
<span class="linenos">1246</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_differing_bits_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1247</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1248</span><span class="sd">        Returns an ASCII string that represents the number of circuits with a 1 at each bit in the bitstream</span>
<span class="linenos">1249</span><span class="sd">        Returns</span>
<span class="linenos">1250</span><span class="sd">        -------</span>
<span class="linenos">1251</span><span class="sd">        str</span>
<span class="linenos">1252</span><span class="sd">            The number of circuits with a 1 at each bit in the bitstream</span>
<span class="linenos">1253</span><span class="sd">        </span>
<span class="linenos">1254</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1255</span>        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="linenos">1256</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__population_bistream_sum</span><span class="p">:</span>
<span class="linenos">1257</span>            <span class="n">s</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span><span class="o">+</span><span class="mi">32</span><span class="p">)</span>
<span class="linenos">1258</span>        <span class="k">return</span> <span class="n">s</span> </div>

<span class="linenos">1259</span>
<span class="linenos">1260</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__arr_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span><span class="p">):</span>
<span class="linenos">1261</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1262</span><span class="sd">        Returns True if the arrays or equal or False otherwise</span>
<span class="linenos">1263</span><span class="sd">        Compares each element of ar1 and ar2</span>
<span class="linenos">1264</span>
<span class="linenos">1265</span><span class="sd">        Parameters</span>
<span class="linenos">1266</span><span class="sd">        ----------</span>
<span class="linenos">1267</span><span class="sd">        ar1 : list</span>
<span class="linenos">1268</span><span class="sd">            an array</span>
<span class="linenos">1269</span><span class="sd">        ar2 : list</span>
<span class="linenos">1270</span><span class="sd">            an array</span>
<span class="linenos">1271</span>
<span class="linenos">1272</span><span class="sd">        Returns</span>
<span class="linenos">1273</span><span class="sd">        -------</span>
<span class="linenos">1274</span><span class="sd">        bool</span>
<span class="linenos">1275</span><span class="sd">            True if the arrays are equivalent in content and order, False otherwise.</span>
<span class="linenos">1276</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1277</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar2</span><span class="p">):</span>
<span class="linenos">1278</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">1279</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar1</span><span class="p">)):</span>
<span class="linenos">1280</span>            <span class="k">if</span> <span class="n">ar1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ar2</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<span class="linenos">1281</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">1282</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">1283</span>
<span class="linenos">1284</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__files_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp1</span><span class="p">,</span> <span class="n">fp2</span><span class="p">):</span>
<span class="linenos">1285</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1286</span><span class="sd">        Returns true if the files are equal (have the same content)</span>
<span class="linenos">1287</span>
<span class="linenos">1288</span><span class="sd">        Parameters</span>
<span class="linenos">1289</span><span class="sd">        ----------</span>
<span class="linenos">1290</span><span class="sd">        fp1 : str</span>
<span class="linenos">1291</span><span class="sd">            Path to file 1</span>
<span class="linenos">1292</span><span class="sd">        fp2 : str</span>
<span class="linenos">1293</span><span class="sd">            Path to file 2</span>
<span class="linenos">1294</span>
<span class="linenos">1295</span><span class="sd">        Returns</span>
<span class="linenos">1296</span><span class="sd">        -------</span>
<span class="linenos">1297</span><span class="sd">        bool</span>
<span class="linenos">1298</span><span class="sd">            True if both files contain the same content, False otherwise.</span>
<span class="linenos">1299</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1300</span>        <span class="n">content1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1301</span>        <span class="n">content2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1302</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">content</span><span class="p">:</span>
<span class="linenos">1303</span>            <span class="n">content1</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">1304</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp2</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">content</span><span class="p">:</span>
<span class="linenos">1305</span>            <span class="n">content2</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">1306</span>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">content1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">content2</span><span class="p">)</span>
<span class="linenos">1307</span>
<span class="linenos">1308</span>    <span class="c1"># TODO Take a closer look at this function</span>
<span class="linenos">1309</span>    <span class="nd">@staticmethod</span>
<span class="linenos">1310</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__group</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">1311</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1312</span><span class="sd">        .. todo::</span>
<span class="linenos">1313</span><span class="sd">            Take a closer look at this function. Not sure why, but a comment here told me to.</span>
<span class="linenos">1314</span><span class="sd">            Also, further document what this function is I couldn&#39;t tell.</span>
<span class="linenos">1315</span><span class="sd">        </span>
<span class="linenos">1316</span><span class="sd">        Collect data into fixed-length chunks or blocks</span>
<span class="linenos">1317</span><span class="sd">        #grouper(&#39;ABCDEFG&#39;, 3, &#39;x&#39;) --&gt; ABC DEF Gxx</span>
<span class="linenos">1318</span><span class="sd">        Taken from python recipes.</span>
<span class="linenos">1319</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1320</span>
<span class="linenos">1321</span>        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n</span>
<span class="linenos">1322</span>        <span class="k">return</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="linenos">1323</span>
<span class="linenos">1324</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__log_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">event</span><span class="p">):</span>
<span class="linenos">1325</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1326</span><span class="sd">        Emit an event-level log. This function is fulfilled through</span>
<span class="linenos">1327</span><span class="sd">        the logger.</span>
<span class="linenos">1328</span>
<span class="linenos">1329</span><span class="sd">        Parameters</span>
<span class="linenos">1330</span><span class="sd">        ----------</span>
<span class="linenos">1331</span><span class="sd">        level : int</span>
<span class="linenos">1332</span><span class="sd">            The level of importance of the logged information (lower level = higher importance)</span>
<span class="linenos">1333</span><span class="sd">        event : tuple[string]</span>
<span class="linenos">1334</span><span class="sd">            The message being logged</span>
<span class="linenos">1335</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1336</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">log_event</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="linenos">1337</span>
<span class="linenos">1338</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__log_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">info</span><span class="p">):</span>
<span class="linenos">1339</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1340</span><span class="sd">        Emit an info-level log. This function is fulfilled through</span>
<span class="linenos">1341</span><span class="sd">        the logger.</span>
<span class="linenos">1342</span>
<span class="linenos">1343</span><span class="sd">        Parameters</span>
<span class="linenos">1344</span><span class="sd">        ----------</span>
<span class="linenos">1345</span><span class="sd">        level : int</span>
<span class="linenos">1346</span><span class="sd">            The level of importance of the logged information (lower level = higher importance)</span>
<span class="linenos">1347</span><span class="sd">        info : tuple[string]</span>
<span class="linenos">1348</span><span class="sd">            The message being logged</span>
<span class="linenos">1349</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1350</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="linenos">1351</span>
<span class="linenos">1352</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">error</span><span class="p">):</span>
<span class="linenos">1353</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1354</span><span class="sd">        Emit an error-level log. This function is fulfilled through</span>
<span class="linenos">1355</span><span class="sd">        the logger.</span>
<span class="linenos">1356</span>
<span class="linenos">1357</span><span class="sd">        Parameters</span>
<span class="linenos">1358</span><span class="sd">        ----------</span>
<span class="linenos">1359</span><span class="sd">        level : int</span>
<span class="linenos">1360</span><span class="sd">            The level of importance of the logged information (lower level = higher importance)</span>
<span class="linenos">1361</span><span class="sd">        error : tuple[string]</span>
<span class="linenos">1362</span><span class="sd">            The message being logged</span>
<span class="linenos">1363</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1364</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span>
<span class="linenos">1365</span>
<span class="linenos">1366</span>    <span class="k">def</span><span class="w"> </span><span class="nf">__log_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">warning</span><span class="p">):</span>
<span class="linenos">1367</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">1368</span><span class="sd">        Emit a warning-level log. This function is fulfilled through</span>
<span class="linenos">1369</span><span class="sd">        the logger.</span>
<span class="linenos">1370</span>
<span class="linenos">1371</span><span class="sd">        Parameters</span>
<span class="linenos">1372</span><span class="sd">        ----------</span>
<span class="linenos">1373</span><span class="sd">        level : int</span>
<span class="linenos">1374</span><span class="sd">            The level of importance of the logged information (lower level = higher importance)</span>
<span class="linenos">1375</span><span class="sd">        warning : tuple[string]</span>
<span class="linenos">1376</span><span class="sd">            The message being logged</span>
<span class="linenos">1377</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">1378</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">log_warning</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">warning</span><span class="p">)</span></div>

</pre></div>
</article>
        <aside class="nftt-toc">
          
        </aside>
      </div>
    </div>

    <footer class="nftt-footer">
      
<nav id="paginator"></nav>

      <div class="py-5 px-4 px-md-3">
  <div class="container">
    

    <div class="row">
      <div class="col-lg-12 text-center">
        <a class="brand-text d-inline-flex align-items-center mb-2 text-decoration-none" href="/" aria-label="Nefertiti-for-Sphinx">
          <span class="fs-6 fw-bold">Testing Github</span>
        </a>
        
          <ul class="list-unstyled small text-muted">
            <li>2024, Evolvable Hardware</li>
          </ul>
        
        
        <div class="built-with pt-2">
          Built with <a href="http://sphinx-doc.org">Sphinx 7.4.7</a> and <a href="https://github.com/danirus/sphinx-nefertiti">Nefertiti 0.3.7</a>
        </div>
        
      </div>
    </div>
  </div>
</div>
    </footer>
    <script src="../_static/documentation_options.js?v=01f34227"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>

    <script type="text/javascript" src="../_static/sphinx-nefertiti-0.3.7.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.bundle-0.3.7.min.js"></script>
    
    <script type="text/javascript" src="../_static/doc_versions.js"></script>
  </body>
</html>